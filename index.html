<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, user-scalable=no">
    
    <!-- Web App Meta Tags -->
    <meta name="apple-mobile-web-app-capable" content="yes">
    <meta name="apple-mobile-web-app-status-bar-style" content="black-translucent">
    <meta name="apple-mobile-web-app-title" content="Spanish Flashcards">
    <link rel="apple-touch-icon" sizes="180x180" href="https://i.imgur.com/gT7h4v4.png">

    <title>Spanish Flashcards</title>
    
    <!-- Scripts -->
    <script crossorigin src="https://unpkg.com/react@18/umd/react.production.min.js"></script>
    <script crossorigin src="https://unpkg.com/react-dom@18/umd/react-dom.production.min.js"></script>
    <script src="https://unpkg.com/@babel/standalone/babel.min.js"></script>
    <script src="https://cdn.tailwindcss.com"></script>
    
    <!-- Styles -->
    <style>
        .perspective-1000 { perspective: 1000px; }
        .transform-style-preserve-3d { transform-style: preserve-3d; }
        .backface-hidden { backface-visibility: hidden; }
        .rotate-y-180 { transform: rotateY(180deg); }
        /* Prevents flashing highlight on tap in mobile browsers */
        * { -webkit-tap-highlight-color: transparent; }
    </style>
</head>
<body class="overscroll-none">
    <div id="root"></div>

    <script type="text/babel">
        const { useState, useEffect, useMemo, useCallback } = React;

        // --- Icon Components ---
        const BookIcon = () => <svg className="w-6 h-6 text-indigo-600" fill="none" stroke="currentColor" viewBox="0 0 24 24"><path strokeLinecap="round" strokeLinejoin="round" strokeWidth={2} d="M12 6.253v13m0-13C10.832 5.477 9.246 5 7.5 5S4.168 5.477 3 6.253v13C4.168 18.477 5.754 18 7.5 18s3.332.477 4.5 1.253m0-13C13.168 5.477 14.754 5 16.5 5c1.746 0 3.332.477 4.5 1.253v13C19.832 18.477 18.246 18 16.5 18c-1.746 0-3.332.477-4.5 1.253" /></svg>;
        const ChevronLeftIcon = () => <svg className="w-4 h-4" fill="none" stroke="currentColor" viewBox="0 0 24 24"><path strokeLinecap="round" strokeLinejoin="round" strokeWidth={2} d="M15 19l-7-7 7-7" /></svg>;
        const ChevronRightIcon = () => <svg className="w-4 h-4" fill="none" stroke="currentColor" viewBox="0 0 24 24"><path strokeLinecap="round" strokeLinejoin="round" strokeWidth={2} d="M9 5l7 7-7 7" /></svg>;
        const RefreshIcon = () => <svg className="w-4 h-4 text-gray-600" fill="none" stroke="currentColor" viewBox="0 0 24 24"><path strokeLinecap="round" strokeLinejoin="round" strokeWidth={2} d="M4 4v5h.582m15.356 2A8.001 8.001 0 004.582 9m0 0H9m11 11v-5h-.581m0 0a8.003 8.003 0 01-15.357-2m15.357 2H15" /></svg>;
        const ShuffleIcon = () => <svg className="w-4 h-4 text-gray-600" fill="none" stroke="currentColor" viewBox="0 0 24 24"><path strokeLinecap="round" strokeLinejoin="round" strokeWidth={2} d="M8 16H6a2 2 0 01-2-2V6a2 2 0 012-2h8a2 2 0 012 2v2m-6 12h8a2 2 0 002-2v-8a2 2 0 00-2-2h-8a2 2 0 00-2 2v8a2 2 0 002 2z" /></svg>;
        const SpeakerIcon = () => <svg className="w-4 h-4 text-gray-600" fill="none" stroke="currentColor" viewBox="0 0 24 24"><path strokeLinecap="round" strokeLinejoin="round" strokeWidth="2" d="M15.536 8.464a5 5 0 010 7.072m2.828-9.9a9 9 0 010 12.728M5.586 15H4a1 1 0 01-1-1v-4a1 1 0 011-1h1.586l4.707-4.707C10.923 3.663 12 4.109 12 5v14c0 .891-1.077 1.337-1.707.707L5.586 15z"></path></svg>;
        const CheckIcon = () => <svg className="w-4 h-4" fill="none" stroke="currentColor" viewBox="0 0 24 24"><path strokeLinecap="round" strokeLinejoin="round" strokeWidth={3} d="M5 13l4 4L19 7" /></svg>;

        // --- DATA SETS ---
        const baseVerbSets = {
            "Essential Being & Having": [ { spanish: "ser", english: "to be (permanent)", conjugations: ["soy", "eres", "es", "somos", "sois", "son"] }, { spanish: "estar", english: "to be (temporary)", conjugations: ["estoy", "estás", "está", "estamos", "estáis", "están"] }, { spanish: "tener", english: "to have", conjugations: ["tengo", "tienes", "tiene", "tenemos", "tenéis", "tienen"] }, { spanish: "haber", english: "to have (auxiliary)", conjugations: ["he", "has", "ha", "hemos", "habéis", "han"] }, { spanish: "existir", english: "to exist", conjugations: ["existo", "existes", "existe", "existimos", "existís", "existen"] }, { spanish: "quedar", english: "to remain/stay", conjugations: ["quedo", "quedas", "queda", "quedamos", "quedáis", "quedan"] }, { spanish: "resultar", english: "to turn out", conjugations: ["resulto", "resultas", "resulta", "resultamos", "resultáis", "resultan"] }, { spanish: "parecer", english: "to seem", conjugations: ["parezco", "pareces", "parece", "parecemos", "parecéis", "parecen"] }, { spanish: "convertirse", english: "to become", conjugations: ["me convierto", "te conviertes", "se convierte", "nos convertimos", "os convertís", "se convierten"] }, { spanish: "mantenerse", english: "to maintain oneself", conjugations: ["me mantengo", "te mantienes", "se mantiene", "nos mantenemos", "os mantenéis", "se mantienen"] }, { spanish: "permanecer", english: "to remain", conjugations: ["permanezco", "permaneces", "permanece", "permanecemos", "permanecéis", "permanecen"] }, { spanish: "encontrarse", english: "to be located/feel", conjugations: ["me encuentro", "te encuentras", "se encuentra", "nos encontramos", "os encontráis", "se encuentran"] }, { spanish: "hallarse", english: "to find oneself", conjugations: ["me hallo", "te hallas", "se halla", "nos hallamos", "os halláis", "se hallan"] }, { spanish: "constituir", english: "to constitute", conjugations: ["constituyo", "constituyes", "constituye", "constituimos", "constituís", "constituyen"] }, { spanish: "representar", english: "to represent", conjugations: ["represento", "representas", "representa", "representamos", "representáis", "representan"] } ],
            "Movement & Travel": [ { spanish: "ir", english: "to go", conjugations: ["voy", "vas", "va", "vamos", "vais", "van"] }, { spanish: "venir", english: "to come", conjugations: ["vengo", "vienes", "viene", "venimos", "venís", "vienen"] }, { spanish: "salir", english: "to leave/go out", conjugations: ["salgo", "sales", "sale", "salimos", "salís", "salen"] }, { spanish: "llegar", english: "to arrive", conjugations: ["llego", "llegas", "llega", "llegamos", "llegáis", "llegan"] }, { spanish: "entrar", english: "to enter", conjugations: ["entro", "entras", "entra", "entramos", "entráis", "entran"] }, { spanish: "volver", english: "to return", conjugations: ["vuelvo", "vuelves", "vuelve", "volvemos", "volvéis", "vuelven"] }, { spanish: "pasar", english: "to pass/go by", conjugations: ["paso", "pasas", "pasa", "pasamos", "pasáis", "pasan"] }, { spanish: "subir", english: "to go up/climb", conjugations: ["subo", "subes", "sube", "subimos", "subís", "suben"] }, { spanish: "bajar", english: "to go down", conjugations: ["bajo", "bajas", "baja", "bajamos", "bajáis", "bajan"] }, { spanish: "mover", english: "to move", conjugations: ["muevo", "mueves", "mueve", "movemos", "movéis", "mueven"] }, { spanish: "viajar", english: "to travel", conjugations: ["viajo", "viajas", "viaja", "viajamos", "viajáis", "viajan"] }, { spanish: "caminar", english: "to walk", conjugations: ["camino", "caminas", "camina", "caminamos", "camináis", "caminan"] }, { spanish: "correr", english: "to run", conjugations: ["corro", "corres", "corre", "corremos", "corréis", "corren"] }, { spanish: "regresar", english: "to return", conjugations: ["regreso", "regresas", "regresa", "regresamos", "regresáis", "regresan"] }, { spanish: "acercarse", english: "to approach", conjugations: ["me acerco", "te acercas", "se acerca", "nos acercamos", "os acercáis", "se acercan"] } ],
            "Communication & Expression": [ { spanish: "hablar", english: "to speak", conjugations: ["hablo", "hablas", "habla", "hablamos", "habláis", "hablan"] }, { spanish: "decir", english: "to say/tell", conjugations: ["digo", "dices", "dice", "decimos", "decís", "dicen"] }, { spanish: "preguntar", english: "to ask", conjugations: ["pregunto", "preguntas", "pregunta", "preguntamos", "preguntáis", "preguntan"] }, { spanish: "responder", english: "to answer", conjugations: ["respondo", "respondes", "responde", "respondemos", "respondéis", "responden"] }, { spanish: "explicar", english: "to explain", conjugations: ["explico", "explica", "explica", "explicamos", "explicáis", "explican"] }, { spanish: "contar", english: "to tell/count", conjugations: ["cuento", "cuentas", "cuenta", "contamos", "contáis", "cuentan"] }, { spanish: "gritar", english: "to shout", conjugations: ["grito", "gritas", "grita", "gritamos", "gritáis", "gritan"] }, { spanish: "susurrar", english: "to whisper", conjugations: ["susurro", "susurras", "susurra", "susurramos", "susurráis", "susurran"] }, { spanish: "mentir", english: "to lie", conjugations: ["miento", "mientes", "miente", "mentimos", "mentís", "mienten"] }, { spanish: "prometer", english: "to promise", conjugations: ["prometo", "prometes", "promete", "prometemos", "prometéis", "prometen"] }, { spanish: "avisar", english: "to warn/notify", conjugations: ["aviso", "avisas", "avisa", "avisamos", "avisáis", "avisan"] }, { spanish: "anunciar", english: "to announce", conjugations: ["anuncio", "anuncias", "anuncia", "anunciamos", "anunciáis", "anuncian"] }, { spanish: "describir", english: "to describe", conjugations: ["describo", "describes", "describe", "describimos", "describís", "describen"] }, { spanish: "expresar", english: "to express", conjugations: ["expreso", "expresas", "expresa", "expresamos", "expresáis", "expresan"] }, { spanish: "comunicar", english: "to communicate", conjugations: ["comunico", "comunicas", "comunica", "comunicamos", "comunicáis", "comunican"] } ],
            "Daily Activities": [ { spanish: "comer", english: "to eat", conjugations: ["como", "comes", "come", "comemos", "coméis", "comen"] }, { spanish: "beber", english: "to drink", conjugations: ["bebo", "bebes", "bebe", "bebemos", "bebéis", "beben"] }, { spanish: "dormir", english: "to sleep", conjugations: ["duermo", "duermes", "duerme", "dormimos", "dormís", "duermen"] }, { spanish: "despertar", english: "to wake up", conjugations: ["despierto", "despiertas", "despierta", "despertamos", "despertáis", "despiertan"] }, { spanish: "levantarse", english: "to get up", conjugations: ["me levanto", "te levantas", "se levanta", "nos levantamos", "os levantáis", "se levantan"] }, { spanish: "ducharse", english: "to shower", conjugations: ["me ducho", "te duchas", "se ducha", "nos duchamos", "os ducháis", "se duchan"] }, { spanish: "vestirse", english: "to get dressed", conjugations: ["me visto", "te vistes", "se viste", "nos vestimos", "os vestís", "se visten"] }, { spanish: "desayunar", english: "to have breakfast", conjugations: ["desayuno", "desayunas", "desayuna", "desayunamos", "desayunáis", "desayunan"] }, { spanish: "almorzar", english: "to have lunch", conjugations: ["almuerzo", "almuerzas", "almuerza", "almorzamos", "almorzáis", "almuerzan"] }, { spanish: "cenar", english: "to have dinner", conjugations: ["ceno", "cenas", "cena", "cenamos", "cenáis", "cenan"] }, { spanish: "acostarse", english: "to go to bed", conjugations: ["me acuesto", "te acuestas", "se acuesta", "nos acostamos", "os acostáis", "se acuestan"] }, { spanish: "peinarse", english: "to comb hair", conjugations: ["me peino", "te peinas", "se peina", "nos peinamos", "os peináis", "se peinan"] }, { spanish: "lavarse", english: "to wash oneself", conjugations: ["me lavo", "te lavas", "se lava", "nos lavamos", "os laváis", "se lavan"] }, { spanish: "cepillarse", english: "to brush", conjugations: ["me cepillo", "te cepillas", "se cepilla", "nos cepillamos", "os cepilláis", "se cepillan"] }, { spanish: "prepararse", english: "to get ready", conjugations: ["me preparo", "te preparas", "se prepara", "nos preparamos", "os preparáis", "se preparan"] } ],
            "Work & Learning": [ { spanish: "trabajar", english: "to work", conjugations: ["trabajo", "trabajas", "trabaja", "trabajamos", "trabajáis", "trabajan"] }, { spanish: "estudiar", english: "to study", conjugations: ["estudio", "estudias", "estudia", "estudiamos", "estudiáis", "estudian"] }, { spanish: "aprender", english: "to learn", conjugations: ["aprendo", "aprendes", "aprende", "aprendemos", "aprendéis", "aprenden"] }, { spanish: "enseñar", english: "to teach", conjugations: ["enseño", "enseñas", "enseña", "enseñamos", "enseñáis", "enseñan"] }, { spanish: "practicar", english: "to practice", conjugations: ["practico", "practicas", "practica", "practicamos", "practicáis", "practican"] }, { spanish: "leer", english: "to read", conjugations: ["leo", "lees", "lee", "leemos", "leéis", "leen"] }, { spanish: "escribir", english: "to write", conjugations: ["escribo", "escribes", "escribe", "escribimos", "escribís", "escriben"] }, { spanish: "investigar", english: "to research", conjugations: ["investigo", "investigas", "investiga", "investigamos", "investigáis", "investigan"] }, { spanish: "examinar", english: "to examine", conjugations: ["examino", "examinas", "examina", "examinamos", "examináis", "examinan"] }, { spanish: "evaluar", english: "to evaluate", conjugations: ["evalúo", "evalúas", "evalúa", "evaluamos", "evaluáis", "evalúan"] }, { spanish: "desarrollar", english: "to develop", conjugations: ["desarrollo", "desarrollas", "desarrolla", "desarrollamos", "desarrolláis", "desarrollan"] }, { spanish: "crear", english: "to create", conjugations: ["creo", "creas", "crea", "creamos", "creáis", "crean"] }, { spanish: "diseñar", english: "to design", conjugations: ["diseño", "diseñas", "diseña", "diseñamos", "diseñáis", "diseñan"] }, { spanish: "construir", english: "to build", conjugations: ["construyo", "construyes", "construye", "construimos", "construís", "construyen"] }, { spanish: "producir", english: "to produce", conjugations: ["produzco", "produces", "produce", "producimos", "producís", "producen"] } ],
            "Actions & Activities": [ { spanish: "hacer", english: "to do/make", conjugations: ["hago", "haces", "hace", "hacemos", "hacéis", "hacen"] }, { spanish: "jugar", english: "to play", conjugations: ["juego", "juegas", "juega", "jugamos", "jugáis", "juegan"] }, { spanish: "cocinar", english: "to cook", conjugations: ["cocino", "cocinas", "cocina", "cocinamos", "cocináis", "cocinan"] }, { spanish: "limpiar", english: "to clean", conjugations: ["limpio", "limpias", "limpia", "limpiamos", "limpiáis", "limpian"] }, { spanish: "abrir", english: "to open", conjugations: ["abro", "abres", "abre", "abrimos", "abrís", "abren"] }, { spanish: "cerrar", english: "to close", conjugations: ["cierro", "cierras", "cierra", "cerramos", "cerráis", "cierran"] }, { spanish: "tocar", english: "to touch/play instrument", conjugations: ["toco", "tocas", "toca", "tocamos", "tocáis", "tocan"] }, { spanish: "cantar", english: "to sing", conjugations: ["canto", "cantas", "canta", "cantamos", "cantáis", "cantan"] }, { spanish: "bailar", english: "to dance", conjugations: ["bailo", "bailas", "baila", "bailamos", "bailáis", "bailan"] }, { spanish: "nadar", english: "to swim", conjugations: ["nado", "nadas", "nada", "nadamos", "nadáis", "nadan"] }, { spanish: "dibujar", english: "to draw", conjugations: ["dibujo", "dibujas", "dibuja", "dibujamos", "dibujáis", "dibujan"] }, { spanish: "pintar", english: "to paint", conjugations: ["pinto", "pintas", "pinta", "pintamos", "pintáis", "pintan"] }, { spanish: "reparar", english: "to repair", conjugations: ["reparo", "reparas", "repara", "reparamos", "reparáis", "reparan"] }, { spanish: "romper", english: "to break", conjugations: ["rompo", "rompes", "rompe", "rompemos", "rompéis", "rompen"] }, { spanish: "construir", english: "to build", conjugations: ["construyo", "construyes", "construye", "construimos", "construís", "construyen"] } ],
            "Thinking & Feeling": [ { spanish: "pensar", english: "to think", conjugations: ["pienso", "piensas", "piensa", "pensamos", "pensáis", "piensan"] }, { spanish: "creer", english: "to believe", conjugations: ["creo", "crees", "cree", "creemos", "creéis", "creen"] }, { spanish: "sentir", english: "to feel", conjugations: ["siento", "sientes", "siente", "sentimos", "sentís", "sienten"] }, { spanish: "querer", english: "to want/love", conjugations: ["quiero", "quieres", "quiere", "queremos", "queréis", "quieren"] }, { spanish: "amar", english: "to love", conjugations: ["amo", "amas", "ama", "amamos", "amáis", "aman"] }, { spanish: "odiar", english: "to hate", conjugations: ["odio", "odias", "odia", "odiamos", "odiáis", "odian"] }, { spanish: "recordar", english: "to remember", conjugations: ["recuerdo", "recuerdas", "recuerda", "recordamos", "recordáis", "recuerdan"] }, { spanish: "olvidar", english: "to forget", conjugations: ["olvido", "olvidas", "olvida", "olvidamos", "olvidáis", "olvidan"] }, { spanish: "decidir", english: "to decide", conjugations: ["decido", "decides", "decide", "decidimos", "decidís", "deciden"] }, { spanish: "esperar", english: "to hope/wait", conjugations: ["espero", "esperas", "espera", "esperamos", "esperáis", "esperan"] }, { spanish: "temer", english: "to fear", conjugations: ["temo", "temes", "teme", "tememos", "teméis", "temen"] }, { spanish: "dudar", english: "to doubt", conjugations: ["dudo", "dudas", "duda", "dudamos", "dudáis", "dudan"] }, { spanish: "imaginar", english: "to imagine", conjugations: ["imagino", "imaginas", "imagina", "imaginamos", "imagináis", "imaginan"] }, { spanish: "soñar", english: "to dream", conjugations: ["sueño", "sueñas", "sueña", "soñamos", "soñáis", "sueñan"] }, { spanish: "preocuparse", english: "to worry", conjugations: ["me preocupo", "te preocupas", "se preocupa", "nos preocupamos", "os preocupáis", "se preocupan"] } ],
            "Buying & Selling": [ { spanish: "comprar", english: "to buy", conjugations: ["compro", "compras", "compra", "compramos", "compráis", "compran"] }, { spanish: "vender", english: "to sell", conjugations: ["vendo", "vendes", "vende", "vendemos", "vendéis", "venden"] }, { spanish: "pagar", english: "to pay", conjugations: ["pago", "pagas", "paga", "pagamos", "pagáis", "pagan"] }, { spanish: "costar", english: "to cost", conjugations: ["cuesto", "cuestas", "cuesta", "costamos", "costáis", "cuestan"] }, { spanish: "valer", english: "to be worth", conjugations: ["valgo", "vales", "vale", "valemos", "valéis", "valen"] }, { spanish: "gastar", english: "to spend", conjugations: ["gasto", "gastas", "gasta", "gastamos", "gastáis", "gastan"] }, { spanish: "ahorrar", english: "to save money", conjugations: ["ahorro", "ahorras", "ahorra", "ahorramos", "ahorráis", "ahorran"] }, { spanish: "prestar", english: "to lend", conjugations: ["presto", "prestas", "presta", "prestamos", "prestáis", "prestan"] }, { spanish: "deber", english: "to owe", conjugations: ["debo", "debes", "debe", "debemos", "debéis", "deben"] }, { spanish: "regalar", english: "to give as gift", conjugations: ["regalo", "regalas", "regala", "regalamos", "regaláis", "regalan"] }, { spanish: "recibir", english: "to receive", conjugations: ["recibo", "recibes", "recibe", "recibimos", "recibís", "reciben"] }, { spanish: "devolver", english: "to return/give back", conjugations: ["devuelvo", "devuelves", "devuelve", "devolvemos", "devolvéis", "devuelven"] }, { spanish: "cambiar", english: "to change/exchange", conjugations: ["cambio", "cambias", "cambia", "cambiamos", "cambiáis", "cambian"] }, { spanish: "elegir", english: "to choose", conjugations: ["elijo", "eliges", "elige", "elegimos", "elegís", "eligen"] }, { spanish: "conseguir", english: "to get/obtain", conjugations: ["consigo", "consigues", "consegue", "conseguimos", "conseguís", "consiguen"] } ],
            "Physical Actions": [ { spanish: "caminar", english: "to walk", conjugations: ["camino", "caminas", "camina", "caminamos", "camináis", "caminan"] }, { spanish: "correr", english: "to run", conjugations: ["corro", "corres", "corre", "corremos", "corréis", "corren"] }, { spanish: "saltar", english: "to jump", conjugations: ["salto", "saltas", "salta", "saltamos", "saltáis", "saltan"] }, { spanish: "caer", english: "to fall", conjugations: ["caigo", "caes", "cae", "caemos", "caéis", "caen"] }, { spanish: "levantar", english: "to lift", conjugations: ["levanto", "levantas", "levanta", "levantamos", "levantáis", "levantan"] }, { spanish: "empujar", english: "to push", conjugations: ["empujo", "empujas", "empuja", "empujamos", "empujáis", "empujan"] }, { spanish: "tirar", english: "to pull/throw", conjugations: ["tiro", "tiras", "tira", "tiramos", "tiráis", "tiran"] }, { spanish: "llevar", english: "to carry/wear", conjugations: ["llevo", "llevas", "lleva", "llevamos", "lleváis", "llevan"] }, { spanish: "traer", english: "to bring", conjugations: ["traigo", "traes", "trae", "traemos", "traéis", "traen"] }, { spanish: "poner", english: "to put", conjugations: ["pongo", "pones", "pone", "ponemos", "ponéis", "ponen"] }, { spanish: "quitar", english: "to remove", conjugations: ["quito", "quitas", "quita", "quitamos", "quitáis", "quitan"] }, { spanish: "agarrar", english: "to grab", conjugations: ["agarro", "agarras", "agarra", "agarramos", "agarráis", "agarran"] }, { spanish: "soltar", english: "to let go", conjugations: ["suelto", "sueltas", "suelta", "soltamos", "soltáis", "sueltan"] }, { spanish: "sostener", english: "to hold", conjugations: ["sostengo", "sostienes", "sostiene", "sostenemos", "sostenéis", "sostienen"] }, { spanish: "lanzar", english: "to throw", conjugations: ["lanzo", "lanzas", "lanza", "lanzamos", "lanzáis", "lanzan"] } ],
            "Social & Relationships": [ { spanish: "conocer", english: "to know/meet", conjugations: ["conozco", "conoces", "conoce", "conocemos", "conocéis", "conocen"] }, { spanish: "encontrar", english: "to find/meet", conjugations: ["encuentro", "encuentras", "encuentra", "encontramos", "encontráis", "encuentran"] }, { spanish: "ver", english: "to see", conjugations: ["veo", "ves", "ve", "vemos", "veis", "ven"] }, { spanish: "mirar", english: "to look at", conjugations: ["miro", "miras", "mira", "miramos", "miráis", "miran"] }, { spanish: "escuchar", english: "to listen", conjugations: ["escucho", "escuchas", "escucha", "escuchamos", "escucháis", "escuchan"] }, { spanish: "oír", english: "to hear", conjugations: ["oigo", "oyes", "oye", "oímos", "oís", "oyen"] }, { spanish: "invitar", english: "to invite", conjugations: ["invito", "invitas", "invita", "invitamos", "invitáis", "invitan"] }, { spanish: "visitar", english: "to visit", conjugations: ["visito", "visitas", "visita", "visitamos", "visitáis", "visitan"] }, { spanish: "ayudar", english: "to help", conjugations: ["ayudo", "ayudas", "ayuda", "ayudamos", "ayudáis", "ayudan"] }, { spanish: "cuidar", english: "to take care of", conjugations: ["cuido", "cuidas", "cuida", "cuidamos", "cuidáis", "cuidan"] }, { spanish: "acompañar", english: "to accompany", conjugations: ["acompaño", "acompañas", "acompaña", "acompañamos", "acompañáis", "acompañan"] }, { spanish: "saludar", english: "to greet", conjugations: ["saludo", "saludas", "saluda", "saludamos", "saludáis", "saludan"] }, { spanish: "despedirse", english: "to say goodbye", conjugations: ["me despido", "te despides", "se despide", "nos despedimos", "os despedís", "se despiden"] }, { spanish: "compartir", english: "to share", conjugations: ["comparto", "compartes", "comparte", "compartimos", "compartís", "comparten"] }, { spanish: "colaborar", english: "to collaborate", conjugations: ["colaboro", "colaboras", "colabora", "colaboramos", "colaboráis", "colaboran"] } ]
        };
        const baseNounSets = {
            "People & Family": [ { spanish: "familia", english: "family" }, { spanish: "madre", english: "mother" }, { spanish: "padre", english: "father" }, { spanish: "hijo", english: "son" }, { spanish: "hija", english: "daughter" }, { spanish: "hermano", english: "brother" }, { spanish: "hermana", english: "sister" }, { spanish: "abuelo", english: "grandfather" }, { spanish: "abuela", english: "grandmother" }, { spanish: "tío", english: "uncle" }, { spanish: "tía", english: "aunt" }, { spanish: "primo", english: "cousin (male)" }, { spanish: "prima", english: "cousin (female)" }, { spanish: "esposo", english: "husband" }, { spanish: "esposa", english: "wife" } ],
            "Home & Furniture": [ { spanish: "casa", english: "house" }, { spanish: "apartamento", english: "apartment" }, { spanish: "habitación", english: "room" }, { spanish: "cocina", english: "kitchen" }, { spanish: "baño", english: "bathroom" }, { spanish: "sala", english: "living room" }, { spanish: "dormitorio", english: "bedroom" }, { spanish: "cama", english: "bed" }, { spanish: "mesa", english: "table" }, { spanish: "silla", english: "chair" }, { spanish: "sofá", english: "sofa" }, { spanish: "armario", english: "closet" }, { spanish: "ventana", english: "window" }, { spanish: "puerta", english: "door" }, { spanish: "escalera", english: "stairs" } ],
            "Food & Drinks": [ { spanish: "comida", english: "food" }, { spanish: "agua", english: "water" }, { spanish: "leche", english: "milk" }, { spanish: "pan", english: "bread" }, { spanish: "carne", english: "meat" }, { spanish: "pollo", english: "chicken" }, { spanish: "pescado", english: "fish" }, { spanish: "fruta", english: "fruit" }, { spanish: "verdura", english: "vegetable" }, { spanish: "arroz", english: "rice" }, { spanish: "pasta", english: "pasta" }, { spanish: "queso", english: "cheese" }, { spanish: "huevo", english: "egg" }, { spanish: "café", english: "coffee" }, { spanish: "té", english: "tea" } ],
            "Clothing & Accessories": [ { spanish: "ropa", english: "clothing" }, { spanish: "camisa", english: "shirt" }, { spanish: "pantalón", english: "pants" }, { spanish: "vestido", english: "dress" }, { spanish: "zapatos", english: "shoes" }, { spanish: "calcetines", english: "socks" }, { spanish: "chaqueta", english: "jacket" }, { spanish: "abrigo", english: "coat" }, { spanish: "sombrero", english: "hat" }, { spanish: "cinturón", english: "belt" }, { spanish: "corbata", english: "tie" }, { spanish: "falda", english: "skirt" }, { spanish: "blusa", english: "blouse" }, { spanish: "suéter", english: "sweater" }, { spanish: "botas", english: "boots" } ],
            "Body & Health": [ { spanish: "cuerpo", english: "body" }, { spanish: "cabeza", english: "head" }, { spanish: "cara", english: "face" }, { spanish: "ojo", english: "eye" }, { spanish: "nariz", english: "nose" }, { spanish: "boca", english: "mouth" }, { spanish: "oreja", english: "ear" }, { spanish: "mano", english: "hand" }, { spanish: "brazo", english: "arm" }, { spanish: "pierna", english: "leg" }, { spanish: "pie", english: "foot" }, { spanish: "corazón", english: "heart" }, { spanish: "estómago", english: "stomach" }, { spanish: "espalda", english: "back" }, { spanish: "cuello", english: "neck" } ],
            "Transportation & Travel": [ { spanish: "coche", english: "car" }, { spanish: "autobús", english: "bus" }, { spanish: "tren", english: "train" }, { spanish: "avión", english: "airplane" }, { spanish: "barco", english: "boat" }, { spanish: "bicicleta", english: "bicycle" }, { spanish: "motocicleta", english: "motorcycle" }, { spanish: "taxi", english: "taxi" }, { spanish: "metro", english: "subway" }, { spanish: "aeropuerto", english: "airport" }, { spanish: "estación", english: "station" }, { spanish: "puerto", english: "port" }, { spanish: "gasolinera", english: "gas station" }, { spanish: "semáforo", english: "traffic light" }, { spanish: "carretera", english: "highway" } ],
            "Work & Education": [ { spanish: "trabajo", english: "job/work" }, { spanish: "oficina", english: "office" }, { spanish: "escuela", english: "school" }, { spanish: "universidad", english: "university" }, { spanish: "clase", english: "class" }, { spanish: "profesor", english: "teacher" }, { spanish: "estudiante", english: "student" }, { spanish: "libro", english: "book" }, { spanish: "cuaderno", english: "notebook" }, { spanish: "lápiz", english: "pencil" }, { spanish: "pluma", english: "pen" }, { spanish: "examen", english: "exam" }, { spanish: "tarea", english: "homework" }, { spanish: "biblioteca", english: "library" }, { spanish: "laboratorio", english: "laboratory" } ],
            "Time & Weather": [ { spanish: "tiempo", english: "time/weather" }, { spanish: "hora", english: "hour" }, { spanish: "minuto", english: "minute" }, { spanish: "día", english: "day" }, { spanish: "semana", english: "week" }, { spanish: "mes", english: "month" }, { spanish: "año", english: "year" }, { spanish: "mañana", english: "morning" }, { spanish: "tarde", english: "afternoon" }, { spanish: "noche", english: "night" }, { spanish: "sol", english: "sun" }, { spanish: "lluvia", english: "rain" }, { spanish: "viento", english: "wind" }, { spanish: "nieve", english: "snow" }, { spanish: "temperatura", english: "temperature" } ],
            "Places & Locations": [ { spanish: "ciudad", english: "city" }, { spanish: "pueblo", english: "town" }, { spanish: "país", english: "country" }, { spanish: "calle", english: "street" }, { spanish: "avenida", english: "avenue" }, { spanish: "plaza", english: "square" }, { spanish: "parque", english: "park" }, { spanish: "tienda", english: "store" }, { spanish: "supermercado", english: "supermarket" }, { spanish: "restaurante", english: "restaurant" }, { spanish: "hospital", english: "hospital" }, { spanish: "banco", english: "bank" }, { spanish: "correos", english: "post office" }, { spanish: "iglesia", english: "church" }, { spanish: "museo", english: "museum" } ],
            "Objects & Technology": [ { spanish: "teléfono", english: "telephone" }, { spanish: "ordenador", english: "computer" }, { spanish: "televisión", english: "television" }, { spanish: "radio", english: "radio" }, { spanish: "cámara", english: "camera" }, { spanish: "reloj", english: "watch/clock" }, { spanish: "llaves", english: "keys" }, { spanish: "dinero", english: "money" }, { spanish: "tarjeta", english: "card" }, { spanish: "bolso", english: "bag/purse" }, { spanish: "maleta", english: "suitcase" }, { spanish: "paraguas", english: "umbrella" }, { spanish: "gafas", english: "glasses" }, { spanish: "periódico", english: "newspaper" }, { spanish: "revista", english: "magazine" } ]
        };
        const basePhraseSets = {
            "Greetings & Introductions": [ { spanish: "Hola, ¿cómo estás?", english: "Hello, how are you?" }, { spanish: "Me llamo...", english: "My name is..." }, { spanish: "¿Cómo te llamas?", english: "What's your name?" }, { spanish: "Mucho gusto", english: "Nice to meet you" }, { spanish: "¿De dónde eres?", english: "Where are you from?" }, { spanish: "Soy de...", english: "I'm from..." }, { spanish: "Buenos días", english: "Good morning" }, { spanish: "Buenas tardes", english: "Good afternoon" }, { spanish: "Buenas noches", english: "Good evening/night" }, { spanish: "Hasta luego", english: "See you later" }, { spanish: "Hasta mañana", english: "See you tomorrow" }, { spanish: "¿Qué tal?", english: "How's it going?" }, { spanish: "Encantado/a", english: "Pleased to meet you" }, { spanish: "Adiós", english: "Goodbye" }, { spanish: "Nos vemos", english: "See you" } ],
            "Basic Courtesy & Politeness": [ { spanish: "Por favor", english: "Please" }, { spanish: "Gracias", english: "Thank you" }, { spanish: "De nada", english: "You're welcome" }, { spanish: "Lo siento", english: "I'm sorry" }, { spanish: "Perdón", english: "Excuse me/Sorry" }, { spanish: "Disculpe", english: "Excuse me (formal)" }, { spanish: "Con permiso", english: "Excuse me (to pass)" }, { spanish: "¿Puedo ayudarle?", english: "Can I help you?" }, { spanish: "No hay problema", english: "No problem" }, { spanish: "Está bien", english: "It's okay" }, { spanish: "Muchas gracias", english: "Thank you very much" }, { spanish: "No se preocupe", english: "Don't worry" }, { spanish: "Perdone la molestia", english: "Sorry to bother you" }, { spanish: "¿Me permite?", english: "May I?" }, { spanish: "Es muy amable", english: "That's very kind" } ],
            "Asking Questions": [ { spanish: "¿Qué es esto?", english: "What is this?" }, { spanish: "¿Dónde está...?", english: "Where is...?" }, { spanish: "¿Cuánto cuesta?", english: "How much does it cost?" }, { spanish: "¿Habla inglés?", english: "Do you speak English?" }, { spanish: "¿Puede repetir?", english: "Can you repeat?" }, { spanish: "¿Cómo se dice...?", english: "How do you say...?" }, { spanish: "¿Qué significa?", english: "What does it mean?" }, { spanish: "¿A qué hora...?", english: "At what time...?" }, { spanish: "¿Por qué?", english: "Why?" }, { spanish: "¿Cuándo?", english: "When?" }, { spanish: "¿Quién es?", english: "Who is it?" }, { spanish: "¿Puedo...?", english: "Can I...?" }, { spanish: "¿Está libre?", english: "Is it free/available?" }, { spanish: "¿Hay...?", english: "Is there.../Are there...?" }, { spanish: "¿Entiende?", english: "Do you understand?" } ],
            "Time & Scheduling": [ { spanish: "¿Qué hora es?", english: "What time is it?" }, { spanish: "Son las dos", english: "It's two o'clock" }, { spanish: "Es la una", english: "It's one o'clock" }, { spanish: "A las tres", english: "At three o'clock" }, { spanish: "Por la mañana", english: "In the morning" }, { spanish: "Por la tarde", english: "In the afternoon" }, { spanish: "Por la noche", english: "At night" }, { spanish: "Hoy", english: "Today" }, { spanish: "Mañana", english: "Tomorrow" }, { spanish: "Ayer", english: "Yesterday" }, { spanish: "Esta semana", english: "This week" }, { spanish: "El fin de semana", english: "The weekend" }, { spanish: "¿Cuándo nos vemos?", english: "When shall we meet?" }, { spanish: "Tengo una cita", english: "I have an appointment" }, { spanish: "Llego tarde", english: "I'm running late" } ],
            "Food & Dining": [ { spanish: "Tengo hambre", english: "I'm hungry" }, { spanish: "Tengo sed", english: "I'm thirsty" }, { spanish: "¿Qué desea?", english: "What would you like?" }, { spanish: "Quisiera...", english: "I would like..." }, { spanish: "La cuenta, por favor", english: "The check, please" }, { spanish: "Está delicioso", english: "It's delicious" }, { spanish: "No me gusta", english: "I don't like it" }, { spanish: "¿Qué recomienda?", english: "What do you recommend?" }, { spanish: "Soy vegetariano/a", english: "I'm vegetarian" }, { spanish: "¿Hay menú en inglés?", english: "Is there an English menu?" }, { spanish: "Un café, por favor", english: "A coffee, please" }, { spanish: "¿Puedo ver la carta?", english: "Can I see the menu?" }, { spanish: "¿Está incluida la propina?", english: "Is the tip included?" }, { spanish: "Me trae..., por favor", english: "Bring me..., please" }, { spanish: "Buen provecho", english: "Enjoy your meal" } ],
            "Shopping & Money": [ { spanish: "¿Cuánto vale?", english: "How much is it worth?" }, { spanish: "Es muy caro", english: "It's very expensive" }, { spanish: "Es barato", english: "It's cheap" }, { spanish: "¿Hay descuento?", english: "Is there a discount?" }, { spanish: "Acepta tarjetas?", english: "Do you accept cards?" }, { spanish: "Solo tengo efectivo", english: "I only have cash" }, { spanish: "¿Dónde pago?", english: "Where do I pay?" }, { spanish: "Me queda bien", english: "It fits me well" }, { spanish: "Es demasiado grande", english: "It's too big" }, { spanish: "Es demasiado pequeño", english: "It's too small" }, { spanish: "¿Tienen mi talla?", english: "Do you have my size?" }, { spanish: "¿Puedo probármelo?", english: "Can I try it on?" }, { spanish: "Me lo llevo", english: "I'll take it" }, { spanish: "¿Está en oferta?", english: "Is it on sale?" }, { spanish: "¿Tiene cambio?", english: "Do you have change?" } ],
            "Directions & Transportation": [ { spanish: "¿Dónde está el baño?", english: "Where is the bathroom?" }, { spanish: "¿Cómo llego a...?", english: "How do I get to...?" }, { spanish: "Está cerca", english: "It's nearby" }, { spanish: "Está lejos", english: "It's far" }, { spanish: "A la derecha", english: "To the right" }, { spanish: "A la izquierda", english: "To the left" }, { spanish: "Todo recto", english: "Straight ahead" }, { spanish: "¿Cuánto tiempo tarda?", english: "How long does it take?" }, { spanish: "Perdí el autobús", english: "I missed the bus" }, { spanish: "¿Dónde para el metro?", english: "Where does the subway stop?" }, { spanish: "¿Este tren va a...?", english: "Does this train go to...?" }, { spanish: "Una ida", english: "One way (ticket)" }, { spanish: "Ida y vuelta", english: "Round trip" }, { spanish: "¿En qué parada bajo?", english: "Which stop do I get off at?" }, { spanish: "¿Puede llamar un taxi?", english: "Can you call a taxi?" } ],
            "Feelings & Opinions": [ { spanish: "Me gusta mucho", english: "I like it a lot" }, { spanish: "No me gusta nada", english: "I don't like it at all" }, { spanish: "Estoy cansado/a", english: "I'm tired" }, { spanish: "Estoy feliz", english: "I'm happy" }, { spanish: "Estoy triste", english: "I'm sad" }, { spanish: "Tengo miedo", english: "I'm scared" }, { spanish: "Estoy preocupado/a", english: "I'm worried" }, { spanish: "Me siento bien", english: "I feel good" }, { spanish: "No me siento bien", english: "I don't feel well" }, { spanish: "Creo que sí", english: "I think so" }, { spanish: "Creo que no", english: "I don't think so" }, { spanish: "No estoy seguro/a", english: "I'm not sure" }, { spanish: "Tienes razón", english: "You're right" }, { spanish: "No estoy de acuerdo", english: "I don't agree" }, { spanish: "¡Qué bonito!", english: "How beautiful!" } ],
            "Emergency & Health": [ { spanish: "¡Ayuda!", english: "Help!" }, { spanish: "Llame a la policía", english: "Call the police" }, { spanish: "Necesito un médico", english: "I need a doctor" }, { spanish: "Me duele...", english: "...hurts" }, { spanish: "Me duele la cabeza", english: "I have a headache" }, { spanish: "Estoy enfermo/a", english: "I'm sick" }, { spanish: "Tengo fiebre", english: "I have a fever" }, { spanish: "¿Dónde está el hospital?", english: "Where is the hospital?" }, { spanish: "Es una emergencia", english: "It's an emergency" }, { spanish: "Perdí mi pasaporte", english: "I lost my passport" }, { spanish: "Me robaron", english: "I was robbed" }, { spanish: "¿Habla español?", english: "Do you speak Spanish?" }, { spanish: "No hablo español", english: "I don't speak Spanish" }, { spanish: "Necesito ayuda", english: "I need help" }, { spanish: "¿Puede llamar...?", english: "Can you call...?" } ],
            "Daily Conversations": [ { spanish: "¿Qué tiempo hace?", english: "What's the weather like?" }, { spanish: "Hace calor", english: "It's hot" }, { spanish: "Hace frío", english: "It's cold" }, { spanish: "Llueve", english: "It's raining" }, { spanish: "¿Qué planes tienes?", english: "What are your plans?" }, { spanish: "Nada especial", english: "Nothing special" }, { spanish: "¿Te gusta...?", english: "Do you like...?" }, { spanish: "Por supuesto", english: "Of course" }, { spanish: "Claro que sí", english: "Of course/Sure" }, { spanish: "No importa", english: "It doesn't matter" }, { spanish: "Depende", english: "It depends" }, { spanish: "¡Qué interesante!", english: "How interesting!" }, { spanish: "No lo sé", english: "I don't know" }, { spanish: "Quizás", english: "Maybe/Perhaps" }, { spanish: "¡Hasta pronto!", english: "See you soon!" } ]
        };
        const allDataSets = { ...baseVerbSets, ...baseNounSets, ...basePhraseSets };

        // --- Refactored Component: Flashcard ---
        const Flashcard = ({ card, isFlipped, mode }) => {
            const getDynamicFontSize = (text) => {
                if (!text) return 'sm:text-5xl text-4xl';
                if (text.length > 30) return 'sm:text-3xl text-2xl';
                if (text.length > 20) return 'sm:text-4xl text-3xl';
                return 'sm:text-5xl text-4xl';
            };
            
            if (!card) {
                return (
                    <div className="absolute inset-0 w-full h-full bg-white rounded-xl shadow-lg border-2 border-gray-200 flex flex-col items-center justify-center p-4 text-center">
                        <div className="text-lg text-gray-600 font-medium">You've mastered all cards in this set!</div>
                        <div className="text-sm text-gray-500 mt-2">Deselect a category or press Reset to study again.</div>
                    </div>
                );
            }

            const frontText = mode === 'spanish-to-english' ? card.spanish : card.english;
            const backText = mode === 'spanish-to-english' ? card.english : card.spanish;

            return (
                <div className={`absolute inset-0 w-full h-full transition-transform duration-500 transform-style-preserve-3d ${isFlipped ? 'rotate-y-180' : ''}`}>
                    <div className="absolute inset-0 w-full h-full bg-white rounded-xl shadow-lg border-2 border-indigo-100 backface-hidden flex flex-col items-center justify-center p-6">
                        <div className="text-xs uppercase tracking-wide text-gray-500 mb-2">{mode === 'spanish-to-english' ? 'Español' : 'English'}</div>
                        <div className={`font-bold text-gray-800 text-center ${getDynamicFontSize(frontText)}`}>{frontText}</div>
                        <div className="absolute bottom-4 text-xs text-gray-400 mt-4">Tap or swipe</div>
                    </div>
                    <div className="absolute inset-0 w-full h-full bg-indigo-50 rounded-xl shadow-lg border-2 border-indigo-200 backface-hidden rotate-y-180 flex flex-col items-center justify-center p-6">
                        <div className="text-xs uppercase tracking-wide text-indigo-600 mb-2">{mode === 'spanish-to-english' ? 'English' : 'Español'}</div>
                        <div className={`font-bold text-indigo-800 text-center mb-4 ${getDynamicFontSize(backText)}`}>{backText}</div>
                        {card.type === 'verb' && (
                            <div className="w-full max-w-xs">
                                <div className="text-xs text-indigo-600 text-center mb-2">Present Tense Conjugations</div>
                                <div className="grid grid-cols-2 gap-x-4 gap-y-1 text-sm">
                                    {["yo", "tú", "él/ella", "nosotros", "vosotros", "ellos/ellas"].map((p, i) => <React.Fragment key={p}><div className="text-right text-indigo-700">{p}</div><div className="font-medium text-indigo-900">{card.conjugations[i]}</div></React.Fragment>)}
                                </div>
                            </div>
                        )}
                        <div className="absolute bottom-4 text-xs text-indigo-400">Tap or swipe</div>
                    </div>
                </div>
            );
        };

        // --- Refactored Component: DeckControls ---
        const DeckControls = ({ handlers, state }) => (
            <div className="flex justify-between items-center mb-6 mt-4">
                <button onClick={handlers.handlePrevious} disabled={state.deckSize < 2} className="flex items-center gap-2 px-4 py-2 bg-white rounded-lg shadow-sm border disabled:opacity-50 disabled:cursor-not-allowed hover:bg-gray-50 transition-colors text-sm"><ChevronLeftIcon />Previous</button>
                <div className="flex items-center gap-2">
                    <button onClick={handlers.resetDeckProgress} disabled={state.totalPotentialCards === 0} className="p-2 bg-white rounded-lg shadow-sm border hover:bg-gray-50 transition-colors disabled:opacity-50 disabled:cursor-not-allowed" title="Reset Progress for Selected Sets" aria-label="Reset deck progress"><RefreshIcon /></button>
                    <button onClick={handlers.handleSpeakerClick} disabled={!state.isCardPresent} className="p-2 bg-white rounded-lg shadow-sm border hover:bg-gray-50 transition-colors disabled:opacity-50 disabled:cursor-not-allowed" title="Play audio" aria-label="Play audio"><SpeakerIcon /></button>
                    <button onClick={handlers.handleToggleRemembered} disabled={!state.isCardPresent} className={`p-2 rounded-lg shadow-sm border transition-colors disabled:opacity-50 disabled:cursor-not-allowed ${state.isRemembered ? 'bg-green-500 text-white border-green-600 hover:bg-green-600' : 'bg-white text-gray-600 hover:bg-gray-50'}`} title={state.isRemembered ? "Mark as not known" : "Mark as known"}><CheckIcon /></button>
                </div>
                <button onClick={handlers.handleNext} disabled={state.deckSize < 2} className="flex items-center gap-2 px-4 py-2 bg-indigo-600 text-white rounded-lg shadow-sm disabled:opacity-50 disabled:cursor-not-allowed hover:bg-indigo-700 transition-colors text-sm">Next<ChevronRightIcon /></button>
            </div>
        );

        // --- Refactored Component: CategoryTabs ---
        const CategoryTabs = ({ activeTab, setActiveTab, activeSets, handleSetToggle }) => {
             const CheckboxGrid = ({ sets, type, onToggleAll }) => (
                <div className="mb-6 bg-white/50 p-4 rounded-lg border border-gray-200 shadow-sm">
                    <div className="flex justify-between items-center mb-3">
                        <label className="text-sm font-medium text-gray-800">Choose {type} Sets:</label>
                        <div className="flex gap-2">
                            <button onClick={() => onToggleAll(sets, true)} className="text-xs font-medium text-indigo-600 hover:text-indigo-800">Select All</button>
                            <button onClick={() => onToggleAll(sets, false)} className="text-xs font-medium text-indigo-600 hover:text-indigo-800">Deselect All</button>
                        </div>
                    </div>
                    <div className="grid grid-cols-1 sm:grid-cols-2 gap-x-4 gap-y-2">
                        {Object.keys(sets).map((setName) => (
                            <label key={setName} className="flex items-center space-x-2 cursor-pointer p-2 rounded-md hover:bg-indigo-100/50">
                                <input type="checkbox" checked={!!activeSets[setName]} onChange={() => handleSetToggle(setName)} className="h-4 w-4 rounded border-gray-300 text-indigo-600 focus:ring-indigo-500"/>
                                <span className="text-sm text-gray-700 select-none">{setName}</span>
                            </label>
                        ))}
                    </div>
                </div>
            );
            return (
                <div>
                    <div className="border-b border-gray-200"><nav className="-mb-px flex justify-center gap-6" aria-label="Tabs">
                        <button onClick={() => setActiveTab('verbs')} className={`${activeTab === 'verbs' ? 'border-indigo-500 text-indigo-600' : 'border-transparent text-gray-500 hover:text-gray-700'} py-4 px-1 border-b-2 font-medium text-sm`}>Verbs</button>
                        <button onClick={() => setActiveTab('nouns')} className={`${activeTab === 'nouns' ? 'border-indigo-500 text-indigo-600' : 'border-transparent text-gray-500 hover:text-gray-700'} py-4 px-1 border-b-2 font-medium text-sm`}>Nouns</button>
                        <button onClick={() => setActiveTab('phrases')} className={`${activeTab === 'phrases' ? 'border-indigo-500 text-indigo-600' : 'border-transparent text-gray-500 hover:text-gray-700'} py-4 px-1 border-b-2 font-medium text-sm`}>Phrases</button>
                    </nav></div>
                    <div className="pt-5">
                        {activeTab === 'verbs' && <CheckboxGrid sets={baseVerbSets} type="Verb" onToggleAll={(sets, shouldSelect) => Object.keys(sets).forEach(name => handleSetToggle(name, shouldSelect))} />}
                        {activeTab === 'nouns' && <CheckboxGrid sets={baseNounSets} type="Noun" onToggleAll={(sets, shouldSelect) => Object.keys(sets).forEach(name => handleSetToggle(name, shouldSelect))} />}
                        {activeTab === 'phrases' && <CheckboxGrid sets={basePhraseSets} type="Phrase" onToggleAll={(sets, shouldSelect) => Object.keys(sets).forEach(name => handleSetToggle(name, shouldSelect))} />}
                    </div>
                </div>
            );
        };

        // --- Main App Component ---
        const SpanishFlashcards = () => {
            const [currentIndex, setCurrentIndex] = useState(0);
            const [isFlipped, setIsFlipped] = useState(false);
            const [mode, setMode] = useState('spanish-to-english');
            const [activeTab, setActiveTab] = useState('verbs');
            const [activeSets, setActiveSets] = useState({ "Essential Being & Having": true });
            const [shuffledCards, setShuffledCards] = useState([]);
            const [voices, setVoices] = useState([]);
            const [touchState, setTouchState] = useState({ start: null, end: null });

            const [rememberedCards, setRememberedCards] = useState(() => {
                try {
                    const saved = localStorage.getItem('rememberedSpanishCards');
                    return saved ? new Set(JSON.parse(saved)) : new Set();
                } catch { return new Set(); }
            });

            useEffect(() => {
                const handler = setTimeout(() => {
                    localStorage.setItem('rememberedSpanishCards', JSON.stringify(Array.from(rememberedCards)));
                }, 500);
                return () => clearTimeout(handler);
            }, [rememberedCards]);
            
            useEffect(() => {
                const loadVoices = () => setVoices(window.speechSynthesis.getVoices());
                window.speechSynthesis.onvoiceschanged = loadVoices; loadVoices();
            }, []);

            const totalPotentialCards = useMemo(() => {
                const getSetType = (setName) => {
                    if (baseVerbSets[setName]) return 'verb';
                    if (baseNounSets[setName]) return 'noun';
                    if (basePhraseSets[setName]) return 'phrase';
                };
                return Object.keys(activeSets).flatMap(setName => 
                    (activeSets[setName] && allDataSets[setName]) 
                        ? allDataSets[setName].map(card => ({ ...card, type: getSetType(setName) })) 
                        : []
                ).filter((card, index, self) => index === self.findIndex(c => c.spanish === card.spanish));
            }, [activeSets]);

            const shuffle = (array) => {
                const newArray = [...array];
                for (let i = newArray.length - 1; i > 0; i--) {
                    const j = Math.floor(Math.random() * (i + 1));
                    [newArray[i], newArray[j]] = [newArray[j], newArray[i]];
                }
                return newArray;
            };
            
            // Rebuild deck only when categories change
            useEffect(() => {
                const cardsToStudy = totalPotentialCards.filter(card => !rememberedCards.has(card.spanish));
                setShuffledCards(shuffle(cardsToStudy));
                setCurrentIndex(0);
                setIsFlipped(false);
            }, [totalPotentialCards]);

            const speakText = useCallback((text) => {
                if (!('speechSynthesis' in window)) return;
                window.speechSynthesis.cancel();
                const utterance = new SpeechSynthesisUtterance(text);
                utterance.lang = 'es-ES';
                utterance.rate = 0.8;
                const spanishVoice = voices.find(v => v.lang === 'es-ES') || voices.find(v => v.lang.startsWith('es-'));
                if (spanishVoice) utterance.voice = spanishVoice;
                setTimeout(() => window.speechSynthesis.speak(utterance), 100);
            }, [voices]);

            const handleNext = () => {
                if (shuffledCards.length === 0) return;
                setCurrentIndex(i => (i + 1) % shuffledCards.length);
                setIsFlipped(false);
            };
            const handlePrevious = () => {
                if (shuffledCards.length === 0) return;
                setCurrentIndex(i => (i - 1 + shuffledCards.length) % shuffledCards.length);
                setIsFlipped(false);
            };
            const handleFlip = () => { if (shuffledCards.length > 0) setIsFlipped(f => !f); };
            const handleSpeakerClick = () => { if (shuffledCards[currentIndex]) speakText(shuffledCards[currentIndex].spanish); };
            
            // Shuffle re-filters the current deck against remembered cards
            const handleShuffle = () => {
                const cardsToStudy = totalPotentialCards.filter(card => !rememberedCards.has(card.spanish));
                setShuffledCards(shuffle(cardsToStudy));
                setCurrentIndex(0);
                setIsFlipped(false);
            };
            
            // Toggle only changes the state, does not advance or reshuffle
            const handleToggleRemembered = () => {
                const currentCard = shuffledCards[currentIndex];
                if (!currentCard) return;
                setRememberedCards(prev => {
                    const newSet = new Set(prev);
                    if (newSet.has(currentCard.spanish)) newSet.delete(currentCard.spanish);
                    else newSet.add(currentCard.spanish);
                    return newSet;
                });
            };

            const resetDeckProgress = () => {
                const cardsToReset = totalPotentialCards.map(card => card.spanish);
                const newRememberedSet = new Set(rememberedCards);
                cardsToReset.forEach(id => newRememberedSet.delete(id));
                setRememberedCards(newRememberedSet);

                // Rebuild the deck immediately so the change is visible
                setShuffledCards(shuffle(totalPotentialCards));
                setCurrentIndex(0);
                setIsFlipped(false);
            };

            const handleSetToggle = (setName, forceState) => {
                const isCurrentlyActive = !!activeSets[setName];
                const shouldBeActive = typeof forceState === 'boolean' ? forceState : !isCurrentlyActive;

                if (isCurrentlyActive === shouldBeActive) return;

                if (!shouldBeActive) {
                    const cardsInSet = allDataSets[setName].map(c => c.spanish);
                    setRememberedCards(prev => {
                        const newSet = new Set(prev);
                        cardsInSet.forEach(id => newSet.delete(id));
                        return newSet;
                    });
                }
                setActiveSets(prev => ({ ...prev, [setName]: shouldBeActive }));
            };
            
            const onTouchStart = (e) => setTouchState({ start: e.targetTouches[0].clientX, end: null });
            const onTouchMove = (e) => setTouchState(s => ({ ...s, end: e.targetTouches[0].clientX }));
            const onTouchEnd = (e) => {
                const { start, end } = touchState;
                if (start === null) return;
                const distance = end ? Math.abs(start - end) : 0;
                const minSwipeDistance = 50;
                const maxTapDistance = 10;
                if (distance > minSwipeDistance) {
                    if (start - end > 0) handleNext(); else handlePrevious();
                } else if (distance < maxTapDistance) {
                    e.preventDefault(); handleFlip();
                }
                setTouchState({ start: null, end: null });
            };

            const currentCard = shuffledCards[currentIndex];
            const rememberedCountInSet = totalPotentialCards.length - shuffledCards.length;
            const progress = totalPotentialCards.length > 0 ? (rememberedCountInSet / totalPotentialCards.length) * 100 : 0;
            const isRemembered = currentCard && rememberedCards.has(currentCard.spanish);

            return (
                <div className="min-h-screen bg-gradient-to-br from-blue-50 to-indigo-100 p-4 flex flex-col">
                    <div className="max-w-md mx-auto w-full flex flex-col flex-grow">
                        <header className="text-center mb-6">
                            <div className="flex items-center justify-center gap-2 mb-2"><BookIcon /><h1 className="text-2xl sm:text-3xl font-bold text-gray-800">Spanish Flashcards</h1></div>
                        </header>

                        <div className="mb-4">
                            <div className="flex justify-between text-sm text-gray-600 mb-1"><span>Mastery Progress</span><span>{rememberedCountInSet}/{totalPotentialCards.length} ({progress.toFixed(0)}%)</span></div>
                            <div className="w-full bg-gray-200 rounded-full h-2"><div className="bg-green-500 h-2 rounded-full" style={{ width: `${progress}%` }}></div></div>
                        </div>
                        <div className="flex justify-between items-center mb-6">
                            <button onClick={() => setMode(m => m === 'spanish-to-english' ? 'english-to-spanish' : 'spanish-to-english')} className="px-3 py-2 bg-white rounded-lg shadow-sm border text-sm font-medium text-gray-700 hover:bg-gray-50">{mode === 'spanish-to-english' ? 'ES → EN' : 'EN → ES'}</button>
                            <div className="text-sm font-medium text-gray-600">{shuffledCards.length > 0 ? `Card ${currentIndex + 1} / ${shuffledCards.length}` : 'Deck Empty'}</div>
                            <button onClick={handleShuffle} disabled={shuffledCards.length < 2} className="p-2 bg-white rounded-lg shadow-sm border hover:bg-gray-50 disabled:opacity-50"><ShuffleIcon /></button>
                        </div>

                        <div className="relative w-full h-80 cursor-pointer perspective-1000" onTouchStart={onTouchStart} onTouchMove={onTouchMove} onTouchEnd={onTouchEnd} onClick={handleFlip}>
                            <Flashcard card={currentCard} isFlipped={isFlipped} mode={mode} />
                        </div>
                        
                        <DeckControls 
                            handlers={{ handlePrevious, resetDeckProgress, handleSpeakerClick, handleToggleRemembered, handleNext }}
                            state={{ deckSize: shuffledCards.length, totalPotentialCards: totalPotentialCards.length, isCardPresent: !!currentCard, isRemembered }}
                        />

                        <div className="flex-grow"></div>

                        <CategoryTabs activeTab={activeTab} setActiveTab={setActiveTab} activeSets={activeSets} handleSetToggle={handleSetToggle} />
                    </div>
                </div>
            );
        };

        const root = ReactDOM.createRoot(document.getElementById('root'));
        root.render(<SpanishFlashcards />);
    </script>
</body>
</html>
