<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, user-scalable=no">
    
    <!-- Web App Meta Tags -->
    <meta name="apple-mobile-web-app-capable" content="yes">
    <meta name="apple-mobile-web-app-status-bar-style" content="black-translucent">
    <meta name="apple-mobile-web-app-title" content="Spanish Flashcards">
    <link rel="apple-touch-icon" sizes="180x180" href="apple-touch-icon.png">

    <title>Spanish Flashcards</title>
    
    <!-- Scripts -->
    <script crossorigin src="https://unpkg.com/react@18/umd/react.production.min.js"></script>
    <script crossorigin src="https://unpkg.com/react-dom@18/umd/react-dom.production.min.js"></script>
    <script src="https://unpkg.com/@babel/standalone/babel.min.js"></script>
    <script src="https://cdn.tailwindcss.com"></script>
    
    <!-- Styles -->
    <style>
        .perspective-1000 { perspective: 1000px; }
        .transform-style-preserve-3d { transform-style: preserve-3d; }
        .backface-hidden { backface-visibility: hidden; }
        .rotate-y-180 { transform: rotateY(180deg); }
        /* Prevents flashing highlight on tap in mobile browsers */
        * { -webkit-tap-highlight-color: transparent; }
        /* Disables pull-to-refresh and other default touch actions on the card */
        .touch-action-none { touch-action: none; }
    </style>
</head>
<body class="overscroll-none">
    <div id="root"></div>

    <script type="text/babel">
        const { useState, useEffect, useMemo, useCallback, useRef } = React;

        // --- Icon Components ---
        const BookIcon = () => <svg className="w-6 h-6 text-indigo-600" fill="none" stroke="currentColor" viewBox="0 0 24 24"><path strokeLinecap="round" strokeLinejoin="round" strokeWidth={2} d="M12 6.253v13m0-13C10.832 5.477 9.246 5 7.5 5S4.168 5.477 3 6.253v13C4.168 18.477 5.754 18 7.5 18s3.332.477 4.5 1.253m0-13C13.168 5.477 14.754 5 16.5 5c1.746 0 3.332.477 4.5 1.253v13C19.832 18.477 18.246 18 16.5 18c-1.746 0-3.332.477-4.5 1.253" /></svg>;
        const ChevronLeftIcon = () => <svg className="w-4 h-4" fill="none" stroke="currentColor" viewBox="0 0 24 24"><path strokeLinecap="round" strokeLinejoin="round" strokeWidth={2} d="M15 19l-7-7 7-7" /></svg>;
        const ChevronRightIcon = () => <svg className="w-4 h-4" fill="none" stroke="currentColor" viewBox="0 0 24 24"><path strokeLinecap="round" strokeLinejoin="round" strokeWidth={2} d="M9 5l7 7-7 7" /></svg>;
        const RefreshIcon = () => <svg className="w-4 h-4 text-gray-600" fill="none" stroke="currentColor" viewBox="0 0 24 24"><path strokeLinecap="round" strokeLinejoin="round" strokeWidth={2} d="M4 4v5h.582m15.356 2A8.001 8.001 0 004.582 9m0 0H9m11 11v-5h-.581m0 0a8.003 8.003 0 01-15.357-2m15.357 2H15" /></svg>;
        const ShuffleIcon = () => <svg className="w-4 h-4 text-gray-600" fill="none" stroke="currentColor" viewBox="0 0 24 24"><path strokeLinecap="round" strokeLinejoin="round" strokeWidth={2} d="M8 16H6a2 2 0 01-2-2V6a2 2 0 012-2h8a2 2 0 012 2v2m-6 12h8a2 2 0 002-2v-8a2 2 0 00-2-2h-8a2 2 0 00-2 2v8a2 2 0 002 2z" /></svg>;
        const SpeakerIcon = () => <svg className="w-4 h-4 text-gray-600" fill="none" stroke="currentColor" viewBox="0 0 24 24"><path strokeLinecap="round" strokeLinejoin="round" strokeWidth="2" d="M15.536 8.464a5 5 0 010 7.072m2.828-9.9a9 9 0 010 12.728M5.586 15H4a1 1 0 01-1-1v-4a1 1 0 011-1h1.586l4.707-4.707C10.923 3.663 12 4.109 12 5v14c0 .891-1.077 1.337-1.707.707L5.586 15z"></path></svg>;
        const CheckIcon = () => <svg className="w-4 h-4" fill="none" stroke="currentColor" viewBox="0 0 24 24"><path strokeLinecap="round" strokeLinejoin="round" strokeWidth={3} d="M5 13l4 4L19 7" /></svg>;

        // --- DATA SETS (WITH FINAL REFINEMENTS) ---
        const baseVerbSets = {
            "Essential Being & Having": [ { spanish: "ser", english: "to be (permanent)", conjugations: ["soy", "eres", "es", "somos", "sois", "son"] }, { spanish: "estar", english: "to be (temporary)", conjugations: ["estoy", "estás", "está", "estamos", "estáis", "están"] }, { spanish: "tener", english: "to have", conjugations: ["tengo", "tienes", "tiene", "tenemos", "tenéis", "tienen"] }, { spanish: "haber", english: "to have done/there is", conjugations: ["he", "has", "ha", "hemos", "habéis", "han"] }, { spanish: "poder", english: "to be able to/can", conjugations: ["puedo", "puedes", "puede", "podemos", "podéis", "pueden"] }, { spanish: "existir", english: "to exist", conjugations: ["existo", "existes", "existe", "existimos", "existís", "existen"] }, { spanish: "quedar", english: "to remain/stay", conjugations: ["quedo", "quedas", "queda", "quedamos", "quedáis", "quedan"] }, { spanish: "resultar", english: "to turn out", conjugations: ["resulto", "resultas", "resulta", "resultamos", "resultáis", "resultan"] }, { spanish: "parecer", english: "to seem", conjugations: ["parezco", "pareces", "parece", "parecemos", "parecéis", "parecen"] }, { spanish: "convertirse", english: "to become", conjugations: ["me convierto", "te conviertes", "se convierte", "nos convertimos", "os convertís", "se convierten"] }, { spanish: "mantenerse", english: "to maintain oneself", conjugations: ["me mantengo", "te mantienes", "se mantiene", "nos mantenemos", "os mantenéis", "se mantienen"] }, { spanish: "permanecer", english: "to remain", conjugations: ["permanezco", "permaneces", "permanece", "permanecemos", "permanecéis", "permanecen"] }, { spanish: "encontrarse", english: "to be located/find oneself", conjugations: ["me encuentro", "te encuentras", "se encuentra", "nos encontramos", "os encontráis", "se encuentran"] }, { spanish: "hallarse", english: "to find oneself", conjugations: ["me hallo", "te hallas", "se halla", "nos hallamos", "os halláis", "se hallan"] }, { spanish: "constituir", english: "to constitute", conjugations: ["constituyo", "constituyes", "constituye", "constituimos", "constituís", "constituyen"] }, { spanish: "ocurrir", english: "to occur", conjugations: ["ocurro", "ocurres", "ocurre", "ocurrimos", "ocurrís", "ocurren"] }, { spanish: "contener", english: "to contain", conjugations: ["contengo", "contienes", "contiene", "contenemos", "contenéis", "contienen"] }, { spanish: "faltar", english: "to lack", conjugations: ["falto", "faltas", "falta", "faltamos", "faltáis", "faltan"] } ],
            "Movement & Travel": [ { spanish: "ir", english: "to go", conjugations: ["voy", "vas", "va", "vamos", "vais", "van"] }, { spanish: "venir", english: "to come", conjugations: ["vengo", "vienes", "viene", "venimos", "venís", "vienen"] }, { spanish: "salir", english: "to exit/go out", conjugations: ["salgo", "sales", "sale", "salimos", "salís", "salen"] }, { spanish: "llegar", english: "to arrive", conjugations: ["llego", "llegas", "llega", "llegamos", "llegáis", "llegan"] }, { spanish: "entrar", english: "to enter", conjugations: ["entro", "entras", "entra", "entramos", "entráis", "entran"] }, { spanish: "volver", english: "to return/come back", conjugations: ["vuelvo", "vuelves", "vuelve", "volvemos", "volvéis", "vuelven"] }, { spanish: "pasar", english: "to pass/happen", conjugations: ["paso", "pasas", "pasa", "pasamos", "pasáis", "pasan"] }, { spanish: "caminar", english: "to walk", conjugations: ["camino", "caminas", "camina", "caminamos", "camináis", "caminan"] }, { spanish: "correr", english: "to run", conjugations: ["corro", "corres", "corre", "corremos", "corréis", "corren"] }, { spanish: "viajar", english: "to travel", conjugations: ["viajo", "viajas", "viaja", "viajamos", "viajáis", "viajan"] }, { spanish: "conducir", english: "to drive", conjugations: ["conduzco", "conduces", "conduce", "conducimos", "conducís", "conducen"] }, { spanish: "regresar", english: "to return/go back", conjugations: ["regreso", "regresas", "regresa", "regresamos", "regresáis", "regresan"] }, { spanish: "acercarse", english: "to approach", conjugations: ["me acerco", "te acercas", "se acerca", "nos acercamos", "os acercáis", "se acercan"] }, { spanish: "alejarse", english: "to move away", conjugations: ["me alejo", "te alejas", "se aleja", "nos alejamos", "os alejáis", "se alejan"] }, { spanish: "dirigirse", english: "to head towards", conjugations: ["me dirijo", "te diriges", "se dirige", "nos dirigimos", "os dirigís", "se dirigen"] }, { spanish: "alcanzar", english: "to reach", conjugations: ["alcanzo", "alcanzas", "alcanza", "alcanzamos", "alcanzáis", "alcanzan"] }, { spanish: "aparcar", english: "to park", conjugations: ["aparco", "aparcas", "aparca", "aparcamos", "aparcáis", "aparcan"] }, { spanish: "navegar", english: "to sail", conjugations: ["navego", "navegas", "navega", "navegamos", "navegáis", "navegan"] } ],
            "Communication & Expression": [ { spanish: "hablar", english: "to speak", conjugations: ["hablo", "hablas", "habla", "hablamos", "habláis", "hablan"] }, { spanish: "decir", english: "to say/tell", conjugations: ["digo", "dices", "dice", "decimos", "decís", "dicen"] }, { spanish: "preguntar", english: "to ask", conjugations: ["pregunto", "preguntas", "pregunta", "preguntamos", "preguntáis", "preguntan"] }, { spanish: "responder", english: "to answer", conjugations: ["respondo", "respondes", "responde", "respondemos", "respondéis", "responden"] }, { spanish: "explicar", english: "to explain", conjugations: ["explico", "explicas", "explica", "explicamos", "explicáis", "explican"] }, { spanish: "contar", english: "to tell/count", conjugations: ["cuento", "cuentas", "cuenta", "contamos", "contáis", "cuentan"] }, { spanish: "gritar", english: "to shout", conjugations: ["grito", "gritas", "grita", "gritamos", "gritáis", "gritan"] }, { spanish: "susurrar", english: "to whisper", conjugations: ["susurro", "susurras", "susurra", "susurramos", "susurráis", "susurran"] }, { spanish: "mentir", english: "to lie", conjugations: ["miento", "mientes", "miente", "mentimos", "mentís", "mienten"] }, { spanish: "prometer", english: "to promise", conjugations: ["prometo", "prometes", "promete", "prometemos", "prometéis", "prometen"] }, { spanish: "avisar", english: "to warn/notify", conjugations: ["aviso", "avisas", "avisa", "avisamos", "avisáis", "avisan"] }, { spanish: "anunciar", english: "to announce", conjugations: ["anuncio", "anuncias", "anuncia", "anunciamos", "anunciáis", "anuncian"] }, { spanish: "sugerir", english: "to suggest", conjugations: ["sugiero", "sugieres", "sugiere", "sugerimos", "sugerís", "sugieren"] }, { spanish: "ordenar", english: "to order", conjugations: ["ordeno", "ordenas", "ordena", "ordenamos", "ordenáis", "ordenan"] }, { spanish: "rogar", english: "to beg/plead", conjugations: ["ruego", "ruegas", "ruega", "rogamos", "rogáis", "ruegan"] }, { spanish: "repetir", english: "to repeat", conjugations: ["repito", "repites", "repite", "repetimos", "repetís", "repiten"] }, { spanish: "enviar", english: "to send", conjugations: ["envío", "envías", "envía", "enviamos", "enviáis", "envían"] }, { spanish: "negar", english: "to deny", conjugations: ["niego", "niegas", "niega", "negamos", "negáis", "niegan"] }, { spanish: "rechazar", english: "to reject", conjugations: ["rechazo", "rechazas", "rechaza", "rechazamos", "rechazáis", "rechazan"] } ],
            "Daily Activities": [ { spanish: "comer", english: "to eat", conjugations: ["como", "comes", "come", "comemos", "coméis", "comen"] }, { spanish: "beber", english: "to drink", conjugations: ["bebo", "bebes", "bebe", "bebemos", "bebéis", "beben"] }, { spanish: "dormir", english: "to sleep", conjugations: ["duermo", "duermes", "duerme", "dormimos", "dormís", "duermen"] }, { spanish: "despertar", english: "to wake up", conjugations: ["despierto", "despiertas", "despierta", "despertamos", "despertáis", "despiertan"] }, { spanish: "levantarse", english: "to get up", conjugations: ["me levanto", "te levantas", "se levanta", "nos levantamos", "os levantáis", "se levantan"] }, { spanish: "sentarse", english: "to sit down", conjugations: ["me siento", "te sientas", "se sienta", "nos sentamos", "os sentáis", "se sientan"] }, { spanish: "ducharse", english: "to shower", conjugations: ["me ducho", "te duchas", "se ducha", "nos duchamos", "os ducháis", "se duchan"] }, { spanish: "vestirse", english: "to get dressed", conjugations: ["me visto", "te vistes", "se viste", "nos vestimos", "os vestís", "se visten"] }, { spanish: "desayunar", english: "to have breakfast", conjugations: ["desayuno", "desayunas", "desayuna", "desayunamos", "desayunáis", "desayunan"] }, { spanish: "almorzar", english: "to have lunch", conjugations: ["almuerzo", "almuerzas", "almuerza", "almorzamos", "almorzáis", "almuerzan"] }, { spanish: "cenar", english: "to have dinner", conjugations: ["ceno", "cenas", "cena", "cenamos", "cenáis", "cenan"] }, { spanish: "acostarse", english: "to go to bed", conjugations: ["me acuesto", "te acuestas", "se acuesta", "nos acostamos", "os acostáis", "se acuestan"] }, { spanish: "peinarse", english: "to comb hair", conjugations: ["me peino", "te peinas", "se peina", "nos peinamos", "os peináis", "se peinan"] }, { spanish: "lavarse", english: "to wash oneself", conjugations: ["me lavo", "te lavas", "se lava", "nos lavamos", "os laváis", "se lavan"] }, { spanish: "cepillarse", english: "to brush", conjugations: ["me cepillo", "te cepillas", "se cepilla", "nos cepillamos", "os cepilláis", "se cepillan"] } ],
            "Work & Learning": [ { spanish: "trabajar", english: "to work", conjugations: ["trabajo", "trabajas", "trabaja", "trabajamos", "trabajáis", "trabajan"] }, { spanish: "estudiar", english: "to study", conjugations: ["estudio", "estudias", "estudia", "estudiamos", "estudiáis", "estudian"] }, { spanish: "aprender", english: "to learn", conjugations: ["aprendo", "aprendes", "aprende", "aprendemos", "aprendéis", "aprenden"] }, { spanish: "enseñar", english: "to teach", conjugations: ["enseño", "enseñas", "enseña", "enseñamos", "enseñáis", "enseñan"] }, { spanish: "practicar", english: "to practice", conjugations: ["practico", "practicas", "practica", "practicamos", "practicáis", "practican"] }, { spanish: "leer", english: "to read", conjugations: ["leo", "lees", "lee", "leemos", "leéis", "leen"] }, { spanish: "escribir", english: "to write", conjugations: ["escribo", "escribes", "escribe", "escribimos", "escribís", "escriben"] }, { spanish: "investigar", english: "to research", conjugations: ["investigo", "investigas", "investiga", "investigamos", "investigáis", "investigan"] }, { spanish: "examinar", english: "to examine", conjugations: ["examino", "examinas", "examina", "examinamos", "examináis", "examinan"] }, { spanish: "evaluar", english: "to evaluate", conjugations: ["evalúo", "evalúas", "evalúa", "evaluamos", "evaluáis", "evalúan"] }, { spanish: "desarrollar", english: "to develop", conjugations: ["desarrollo", "desarrollas", "desarrolla", "desarrollamos", "desarrolláis", "desarrollan"] }, { spanish: "crear", english: "to create", conjugations: ["creo", "creas", "crea", "creamos", "creáis", "crean"] }, { spanish: "diseñar", english: "to design", conjugations: ["diseño", "diseñas", "diseña", "diseñamos", "diseñáis", "diseñan"] }, { spanish: "construir", english: "to build", conjugations: ["construyo", "construyes", "construye", "construimos", "construís", "construyen"] }, { spanish: "producir", english: "to produce", conjugations: ["produzco", "produces", "produce", "producimos", "producís", "producen"] }, { spanish: "descubrir", english: "to discover", conjugations: ["descubro", "descubres", "descubre", "descubrimos", "descubrís", "descubren"] }, { spanish: "inventar", english: "to invent", conjugations: ["invento", "inventas", "inventa", "inventamos", "inventáis", "inventan"] }, { spanish: "aparecer", english: "to appear", conjugations: ["aparezco", "apareces", "aparece", "aparecemos", "aparecéis", "aparecen"] } ],
            "Actions & Activities": [ { spanish: "hacer", english: "to do/make", conjugations: ["hago", "haces", "hace", "hacemos", "hacéis", "hacen"] }, { spanish: "jugar", english: "to play", conjugations: ["juego", "juegas", "juega", "jugamos", "jugáis", "juegan"] }, { spanish: "cocinar", english: "to cook", conjugations: ["cocino", "cocinas", "cocina", "cocinamos", "cocináis", "cocinan"] }, { spanish: "limpiar", english: "to clean", conjugations: ["limpio", "limpias", "limpia", "limpiamos", "limpiáis", "limpian"] }, { spanish: "abrir", english: "to open", conjugations: ["abro", "abres", "abre", "abrimos", "abrís", "abren"] }, { spanish: "cerrar", english: "to close", conjugations: ["cierro", "cierras", "cierra", "cerramos", "cerráis", "cierran"] }, { spanish: "tocar", english: "to touch/play instrument", conjugations: ["toco", "tocas", "toca", "tocamos", "tocáis", "tocan"] }, { spanish: "cantar", english: "to sing", conjugations: ["canto", "cantas", "canta", "cantamos", "cantáis", "cantan"] }, { spanish: "bailar", english: "to dance", conjugations: ["bailo", "bailas", "baila", "bailamos", "bailáis", "bailan"] }, { spanish: "nadar", english: "to swim", conjugations: ["nado", "nadas", "nada", "nadamos", "nadáis", "nadan"] }, { spanish: "dibujar", english: "to draw", conjugations: ["dibujo", "dibujas", "dibuja", "dibujamos", "dibujáis", "dibujan"] }, { spanish: "pintar", english: "to paint", conjugations: ["pinto", "pintas", "pinta", "pintamos", "pintáis", "pintan"] }, { spanish: "mostrar", english: "to show", conjugations: ["muestro", "muestras", "muestra", "mostramos", "mostráis", "muestran"] }, { spanish: "buscar", english: "to look for", conjugations: ["busco", "buscas", "busca", "buscamos", "buscáis", "buscan"] }, { spanish: "usar", english: "to use", conjugations: ["uso", "usas", "usa", "usamos", "usáis", "usan"] }, { spanish: "formar", english: "to form", conjugations: ["formo", "formas", "forma", "formamos", "formáis", "forman"] }, { spanish: "pescar", english: "to fish", conjugations: ["pesco", "pescas", "pesca", "pescamos", "pescáis", "pescan"] }, { spanish: "cazar", english: "to hunt", conjugations: ["cazo", "cazas", "caza", "cazamos", "cazáis", "cazan"] }, { spanish: "arreglar", english: "to arrange", conjugations: ["arreglo", "arreglas", "arregla", "arreglamos", "arregláis", "arreglan"] }, { spanish: "arriesgar", english: "to risk", conjugations: ["arriesgo", "arriesgas", "arriesga", "arriesgamos", "arriesgáis", "arriesgan"] } ],
            "Thinking & Feeling": [ { spanish: "pensar", english: "to think", conjugations: ["pienso", "piensas", "piensa", "pensamos", "pensáis", "piensan"] }, { spanish: "creer", english: "to believe", conjugations: ["creo", "crees", "cree", "creemos", "creéis", "creen"] }, { spanish: "sentir", english: "to feel", conjugations: ["siento", "sientes", "siente", "sentimos", "sentís", "sienten"] }, { spanish: "querer", english: "to want/love", conjugations: ["quiero", "quieres", "quiere", "queremos", "queréis", "quieren"] }, { spanish: "amar", english: "to love", conjugations: ["amo", "amas", "ama", "amamos", "amáis", "aman"] }, { spanish: "odiar", english: "to hate", conjugations: ["odio", "odias", "odia", "odiamos", "odiáis", "odian"] }, { spanish: "recordar", english: "to remember", conjugations: ["recuerdo", "recuerdas", "recuerda", "recordamos", "recordáis", "recuerdan"] }, { spanish: "olvidar", english: "to forget", conjugations: ["olvido", "olvidas", "olvida", "olvidamos", "olvidáis", "olvidan"] }, { spanish: "decidir", english: "to decide", conjugations: ["decido", "decides", "decide", "decidimos", "decidís", "deciden"] }, { spanish: "esperar", english: "to hope/wait", conjugations: ["espero", "esperas", "espera", "esperamos", "esperáis", "esperan"] }, { spanish: "confiar", english: "to trust", conjugations: ["confío", "confías", "confía", "confiamos", "confiáis", "confían"] }, { spanish: "desconfiar", english: "to distrust", conjugations: ["desconfío", "desconfías", "desconfía", "desconfiamos", "desconfiáis", "desconfían"] }, { spanish: "admirar", english: "to admire", conjugations: ["admiro", "admiras", "admira", "admiramos", "admiráis", "admiran"] }, { spanish: "agradecer", english: "to thank/appreciate", conjugations: ["agradezco", "agradeces", "agradece", "agradecemos", "agradecéis", "agradecen"] }, { spanish: "suponer", english: "to suppose", conjugations: ["supongo", "supones", "supone", "suponemos", "suponéis", "suponen"] }, { spanish: "considerar", english: "to consider", conjugations: ["considero", "consideras", "considera", "consideramos", "consideráis", "consideran"] }, { spanish: "reconocer", english: "to recognize", conjugations: ["reconozco", "reconoces", "reconoce", "reconocemos", "reconocéis", "reconocen"] }, { spanish: "opinar", english: "to opine", conjugations: ["opino", "opinas", "opina", "opinamos", "opináis", "opinan"] }, { spanish: "enojar", english: "to annoy", conjugations: ["enojo", "enojas", "enoja", "enojamos", "enojáis", "enojan"] }, { spanish: "molestar", english: "to bother", conjugations: ["molesto", "molestas", "molesta", "molestamos", "molestáis", "molestan"] }, { spanish: "importar", english: "to matter/import", conjugations: ["importo", "importas", "importa", "importamos", "importáis", "importan"] }, { spanish: "doler", english: "to hurt/ache", conjugations: ["duelo", "dueles", "duele", "dolemos", "doléis", "duelen"] }, { spanish: "temer", english: "to fear", conjugations: ["temo", "temes", "teme", "tememos", "teméis", "temen"] } ],
            "Buying & Selling": [ { spanish: "comprar", english: "to buy", conjugations: ["compro", "compras", "compra", "compramos", "compráis", "compran"] }, { spanish: "vender", english: "to sell", conjugations: ["vendo", "vendes", "vende", "vendemos", "vendéis", "venden"] }, { spanish: "pagar", english: "to pay", conjugations: ["pago", "pagas", "paga", "pagamos", "pagáis", "pagan"] }, { spanish: "costar", english: "to cost", conjugations: ["-", "-", "cuesta", "-", "-", "cuestan"] }, { spanish: "valer", english: "to be worth", conjugations: ["valgo", "vales", "vale", "valemos", "valéis", "valen"] }, { spanish: "gastar", english: "to spend", conjugations: ["gasto", "gastas", "gasta", "gastamos", "gastáis", "gastan"] }, { spanish: "ahorrar", english: "to save money", conjugations: ["ahorro", "ahorras", "ahorra", "ahorramos", "ahorráis", "ahorran"] }, { spanish: "prestar", english: "to lend", conjugations: ["presto", "prestas", "presta", "prestamos", "prestáis", "prestan"] }, { spanish: "deber", english: "to owe", conjugations: ["debo", "debes", "debe", "debemos", "debéis", "deben"] }, { spanish: "regalar", english: "to give as gift", conjugations: ["regalo", "regalas", "regala", "regalamos", "regaláis", "regalan"] }, { spanish: "recibir", english: "to receive", conjugations: ["recibo", "recibes", "recibe", "recibimos", "recibís", "reciben"] }, { spanish: "devolver", english: "to return/give back", conjugations: ["devuelvo", "devuelves", "devuelve", "devolvemos", "devolvéis", "devuelven"] }, { spanish: "cambiar", english: "to change/exchange", conjugations: ["cambio", "cambias", "cambia", "cambiamos", "cambiáis", "cambian"] }, { spanish: "elegir", english: "to choose", conjugations: ["elijo", "eliges", "elige", "elegimos", "elegís", "eligen"] }, { spanish: "conseguir", english: "to get/obtain", conjugations: ["consigo", "consigues", "consigue", "conseguimos", "conseguís", "consiguen"] } ],
            "Physical Actions": [ { spanish: "subir", english: "to go up/climb", conjugations: ["subo", "subes", "sube", "subimos", "subís", "suben"] }, { spanish: "bajar", english: "to go down", conjugations: ["bajo", "bajas", "baja", "bajamos", "bajáis", "bajan"] }, { spanish: "saltar", english: "to jump", conjugations: ["salto", "saltas", "salta", "saltamos", "saltáis", "saltan"] }, { spanish: "caer", english: "to fall", conjugations: ["caigo", "caes", "cae", "caemos", "caéis", "caen"] }, { spanish: "levantar", english: "to lift", conjugations: ["levanto", "levantas", "levanta", "levantamos", "levantáis", "levantan"] }, { spanish: "empujar", english: "to push", conjugations: ["empujo", "empujas", "empuja", "empujamos", "empujáis", "empujan"] }, { spanish: "tirar", english: "to throw/pull", conjugations: ["tiro", "tiras", "tira", "tiramos", "tiráis", "tiran"] }, { spanish: "llevar", english: "to carry/wear", conjugations: ["llevo", "llevas", "lleva", "llevamos", "lleváis", "llevan"] }, { spanish: "traer", english: "to bring", conjugations: ["traigo", "traes", "trae", "traemos", "traéis", "traen"] }, { spanish: "poner", english: "to put", conjugations: ["pongo", "pones", "pone", "ponemos", "ponéis", "ponen"] }, { spanish: "quitar", english: "to remove", conjugations: ["quito", "quitas", "quita", "quitamos", "quitáis", "quitan"] }, { spanish: "agarrar", english: "to grab", conjugations: ["agarro", "agarras", "agarra", "agarramos", "agarráis", "agarran"] }, { spanish: "soltar", english: "to let go", conjugations: ["suelto", "sueltas", "suelta", "soltamos", "soltáis", "sueltan"] }, { spanish: "sostener", english: "to hold", conjugations: ["sostengo", "sostienes", "sostiene", "sostenemos", "sostenéis", "sostienen"] }, { spanish: "lanzar", english: "to throw", conjugations: ["lanzo", "lanzas", "lanza", "lanzamos", "lanzáis", "lanzan"] }, { spanish: "partir", english: "to split", conjugations: ["parto", "partes", "parte", "partimos", "partís", "parten"] }, { spanish: "ocupar", english: "to occupy", conjugations: ["ocupo", "ocupas", "ocupa", "ocupamos", "ocupáis", "ocupan"] }, { spanish: "romper", english: "to break", conjugations: ["rompo", "rompes", "rompe", "rompemos", "rompéis", "rompen"] }, { spanish: "flotar", english: "to float", conjugations: ["floto", "flotas", "flota", "flotamos", "flotáis", "flotan"] }, { spanish: "hundir", english: "to sink", conjugations: ["hundo", "hundes", "hunde", "hundimos", "hundís", "hunden"] }, { spanish: "enterrar", english: "to bury", conjugations: ["entierro", "entierras", "entierra", "enterramos", "enterráis", "entierran"] }, { spanish: "quemar", english: "to burn", conjugations: ["quemo", "quemas", "quema", "quemamos", "quemáis", "queman"] }, { spanish: "apagar", english: "to extinguish", conjugations: ["apago", "apagas", "apaga", "apagamos", "apagáis", "apagan"] }, { spanish: "encender", english: "to light", conjugations: ["enciendo", "enciendes", "enciende", "encendemos", "encendéis", "encienden"] }, { spanish: "tironear", english: "to pull", conjugations: ["tironeo", "tironeas", "tironea", "tironeamos", "tironeáis", "tironean"] }, { spanish: "atar", english: "to tie", conjugations: ["ato", "atas", "ata", "atamos", "atáis", "atan"] }, { spanish: "desatar", english: "to untie", conjugations: ["desato", "desatas", "desata", "desatamos", "desatáis", "desatan"] }, { spanish: "destapar", english: "to uncover", conjugations: ["destapo", "destapas", "destapa", "destapamos", "destapáis", "destapan"] } ],
            "Social & Relationships": [ { spanish: "conocer", english: "to know/meet", conjugations: ["conozco", "conoces", "conoce", "conocemos", "conocéis", "conocen"] }, { spanish: "saber", english: "to know (facts)", conjugations: ["sé", "sabes", "sabe", "sabemos", "sabéis", "saben"] }, { spanish: "encontrar", english: "to find/encounter", conjugations: ["encuentro", "encuentras", "encuentra", "encontramos", "encontráis", "encuentran"] }, { spanish: "ver", english: "to see", conjugations: ["veo", "ves", "ve", "vemos", "veis", "ven"] }, { spanish: "mirar", english: "to look at", conjugations: ["miro", "miras", "mira", "miramos", "miráis", "miran"] }, { spanish: "escuchar", english: "to listen", conjugations: ["escucho", "escuchas", "escucha", "escuchamos", "escucháis", "escuchan"] }, { spanish: "oír", english: "to hear", conjugations: ["oigo", "oyes", "oye", "oímos", "oís", "oyen"] }, { spanish: "invitar", english: "to invite", conjugations: ["invito", "invitas", "invita", "invitamos", "invitáis", "invitan"] }, { spanish: "visitar", english: "to visit", conjugations: ["visito", "visitas", "visita", "visitamos", "visitáis", "visitan"] }, { spanish: "ayudar", english: "to help", conjugations: ["ayudo", "ayudas", "ayuda", "ayudamos", "ayudáis", "ayudan"] }, { spanish: "cuidar", english: "to take care of", conjugations: ["cuido", "cuidas", "cuida", "cuidamos", "cuidáis", "cuidan"] }, { spanish: "acompañar", english: "to accompany", conjugations: ["acompaño", "acompañas", "acompaña", "acompañamos", "acompañáis", "acompañan"] }, { spanish: "saludar", english: "to greet", conjugations: ["saludo", "saludas", "saluda", "saludamos", "saludáis", "saludan"] }, { spanish: "despedirse", english: "to say goodbye", conjugations: ["me despido", "te despides", "se despide", "nos despedimos", "os despedís", "se despiden"] }, { spanish: "compartir", english: "to share", conjugations: ["comparto", "compartes", "comparte", "compartimos", "compartís", "comparten"] }, { spanish: "llamarse", english: "to be called (one's name)", conjugations: ["me llamo", "te llamas", "se llama", "nos llamamos", "os llamáis", "se llaman"] }, { spanish: "verse", english: "to see each other/be seen", conjugations: ["me veo", "te ves", "se ve", "nos vemos", "os veis", "se ven"] }, { spanish: "obedecer", english: "to obey", conjugations: ["obedezco", "obedeces", "obedece", "obedecemos", "obedecéis", "obedecen"] }, { spanish: "desobedecer", english: "to disobey", conjugations: ["desobedezco", "desobedeces", "desobedece", "desobedecemos", "desobedecéis", "desobedecen"] } ],
            "Life Events & Emotions": [ { spanish: "nacer", english: "to be born", conjugations: ["nazco", "naces", "nace", "nacemos", "nacéis", "nacen"] }, { spanish: "crecer", english: "to grow", conjugations: ["crezco", "creces", "crece", "crecemos", "crecéis", "crecen"] }, { spanish: "envejecer", english: "to age", conjugations: ["envejezco", "envejeces", "envejece", "envejecemos", "envejecéis", "envejecen"] }, { spanish: "morir", english: "to die", conjugations: ["muero", "mueres", "muere", "morimos", "morís", "mueren"] }, { spanish: "enamorarse", english: "to fall in love", conjugations: ["me enamoro", "te enamoras", "se enamora", "nos enamoramos", "os enamoráis", "se enamoran"] }, { spanish: "casarse", english: "to get married", conjugations: ["me caso", "te casas", "se casa", "nos casamos", "os casáis", "se casan"] }, { spanish: "divorciarse", english: "to get divorced", conjugations: ["me divorcio", "te divorcias", "se divorcia", "nos divorciamos", "os divorciáis", "se divorcian"] }, { spanish: "reír", english: "to laugh", conjugations: ["río", "ríes", "ríe", "reímos", "reís", "ríen"] }, { spanish: "sonreír", english: "to smile", conjugations: ["sonrío", "sonríes", "sonríe", "sonreímos", "sonreís", "sonríen"] }, { spanish: "llorar", english: "to cry", conjugations: ["lloro", "lloras", "llora", "lloramos", "lloráis", "lloran"] }, { spanish: "divertirse", english: "to have fun", conjugations: ["me divierto", "te diviertes", "se divierte", "nos divertimos", "os divertís", "se divierten"] }, { spanish: "aburrirse", english: "to get bored", conjugations: ["me aburro", "te aburres", "se aburre", "nos aburrimos", "os aburrís", "se aburren"] }, { spanish: "cansarse", english: "to get tired", conjugations: ["me canso", "te cansas", "se cansa", "nos cansamos", "os cansáis", "se cansan"] }, { spanish: "relajarse", english: "to relax", conjugations: ["me relajo", "te relajas", "se relaja", "nos relajamos", "os relajáis", "se relajan"] }, { spanish: "celebrar", english: "to celebrate", conjugations: ["celebro", "celebras", "celebra", "celebramos", "celebráis", "celebran"] }, { spanish: "ahogarse", english: "to drown", conjugations: ["me ahogo", "te ahogas", "se ahoga", "nos ahogamos", "os ahogáis", "se ahogan"] }, { spanish: "curar", english: "to cure", conjugations: ["curo", "curas", "cura", "curamos", "curáis", "curan"] }, { spanish: "mejorar", english: "to improve", conjugations: ["mejoro", "mejoras", "mejora", "mejoramos", "mejoráis", "mejoran"] }, { spanish: "empeorar", english: "to worsen", conjugations: ["empeoro", "empeoras", "empeora", "empeoramos", "empeoráis", "empeoran"] } ],
            "Cooking & Household": [ { spanish: "cortar", english: "to cut", conjugations: ["corto", "cortas", "corta", "cortamos", "cortáis", "cortan"] }, { spanish: "freír", english: "to fry", conjugations: ["frío", "fríes", "fríe", "freímos", "freís", "fríen"] }, { spanish: "hervir", english: "to boil", conjugations: ["hiervo", "hierves", "hierve", "hervimos", "hervís", "hierven"] }, { spanish: "hornear", english: "to bake", conjugations: ["horneo", "horneas", "hornea", "horneamos", "horneáis", "hornean"] }, { spanish: "mezclar", english: "to mix", conjugations: ["mezclo", "mezclas", "mezcla", "mezclamos", "mezcláis", "mezclan"] }, { spanish: "servir", english: "to serve", conjugations: ["sirvo", "sirves", "sirve", "servimos", "servís", "sirven"] }, { spanish: "llenar", english: "to fill", conjugations: ["lleno", "llenas", "llena", "llenamos", "llenáis", "llenan"] }, { spanish: "vaciar", english: "to empty", conjugations: ["vacío", "vacías", "vacía", "vaciamos", "vaciáis", "vacían"] }, { spanish: "guardar", english: "to save/keep", conjugations: ["guardo", "guardas", "guarda", "guardamos", "guardáis", "guardan"] }, { spanish: "sacar", english: "to take out", conjugations: ["saco", "sacas", "saca", "sacamos", "sacáis", "sacan"] }, { spanish: "meter", english: "to put in", conjugations: ["meto", "metes", "mete", "metemos", "metéis", "meten"] }, { spanish: "colocar", english: "to place", conjugations: ["coloco", "colocas", "coloca", "colocamos", "colocáis", "colocan"] }, { spanish: "colgar", english: "to hang", conjugations: ["cuelgo", "cuelgas", "cuelga", "colgamos", "colgáis", "cuelgan"] }, { spanish: "cubrir", english: "to cover", conjugations: ["cubro", "cubres", "cubre", "cubrimos", "cubrís", "cubren"] }, { spanish: "envolver", english: "to wrap", conjugations: ["envuelvo", "envuelves", "envuelve", "envolvemos", "envolvéis", "envuelven"] } ],
            "Conflict & Justice": [ { spanish: "pelear", english: "to fight", conjugations: ["peleo", "peleas", "pelea", "peleamos", "peleáis", "pelean"] }, { spanish: "atacar", english: "to attack", conjugations: ["ataco", "atacas", "ataca", "atacamos", "atacáis", "atacan"] }, { spanish: "defender", english: "to defend", conjugations: ["defiendo", "defiendes", "defiende", "defendemos", "defendéis", "defienden"] }, { spanish: "proteger", english: "to protect", conjugations: ["protejo", "proteges", "protege", "protegemos", "protegéis", "protegen"] }, { spanish: "escapar", english: "to escape", conjugations: ["escapo", "escapas", "escapa", "escapamos", "escapáis", "escapan"] }, { spanish: "esconder", english: "to hide", conjugations: ["escondo", "escondes", "esconde", "escondemos", "escondéis", "esconden"] }, { spanish: "perseguir", english: "to pursue", conjugations: ["persigo", "persigues", "persigue", "perseguimos", "perseguís", "persiguen"] }, { spanish: "robar", english: "to steal", conjugations: ["robo", "robas", "roba", "robamos", "robáis", "roban"] }, { spanish: "engañar", english: "to deceive", conjugations: ["engaño", "engañas", "engaña", "engañamos", "engañáis", "engañan"] }, { spanish: "juzgar", english: "to judge", conjugations: ["juzgo", "juzgas", "juzga", "juzgamos", "juzgáis", "juzgan"] }, { spanish: "castigar", english: "to punish", conjugations: ["castigo", "castigas", "castiga", "castigamos", "castigáis", "castigan"] }, { spanish: "perdonar", english: "to forgive", conjugations: ["perdono", "perdonas", "perdona", "perdonamos", "perdonáis", "perdonan"] }, { spanish: "disculpar", english: "to excuse/forgive", conjugations: ["disculpo", "disculpas", "disculpa", "disculpamos", "disculpáis", "disculpan"] }, { spanish: "culpar", english: "to blame", conjugations: ["culpo", "culpas", "culpa", "culpamos", "culpáis", "culpan"] }, { spanish: "arrestar", english: "to arrest", conjugations: ["arresto", "arrestas", "arresta", "arrestamos", "arrestáis", "arrestan"] }, { spanish: "detener", english: "to detain", conjugations: ["detengo", "detienes", "detiene", "detenemos", "detenéis", "detienen"] }, { spanish: "matar", english: "to kill", conjugations: ["mato", "matas", "mata", "matamos", "matáis", "matan"] }, { spanish: "destruir", english: "to destroy", conjugations: ["destruyo", "destruyes", "destruye", "destruimos", "destruís", "destruyen"] } ],
            "Starting & Stopping": [ { spanish: "comenzar", english: "to begin", conjugations: ["comienzo", "comienzas", "comienza", "comenzamos", "comenzáis", "comienzan"] }, { spanish: "empezar", english: "to start", conjugations: ["empiezo", "empiezas", "empieza", "empezamos", "empezáis", "empiezan"] }, { spanish: "seguir", english: "to follow/continue", conjugations: ["sigo", "sigues", "sigue", "seguimos", "seguís", "siguen"] }, { spanish: "continuar", english: "to continue", conjugations: ["continúo", "continúas", "continúa", "continuamos", "continuáis", "continúan"] }, { spanish: "terminar", english: "to finish/complete", conjugations: ["termino", "terminas", "termina", "terminamos", "termináis", "terminan"] }, { spanish: "acabar", english: "to finish/end", conjugations: ["acabo", "acabas", "acaba", "acabamos", "acabáis", "acaban"] }, { spanish: "dejar", english: "to leave (behind)/let", conjugations: ["dejo", "dejas", "deja", "dejamos", "dejáis", "dejan"] }, { spanish: "permitir", english: "to allow", conjugations: ["permito", "permites", "permite", "permitimos", "permitís", "permiten"] }, { spanish: "prohibir", english: "to prohibit", conjugations: ["prohíbo", "prohíbes", "prohíbe", "prohibimos", "prohibís", "prohíben"] }, { spanish: "intentar", english: "to try/attempt", conjugations: ["intento", "intentas", "intenta", "intentamos", "intentáis", "intentan"] }, { spanish: "tratar", english: "to treat/deal with", conjugations: ["trato", "tratas", "trata", "tratamos", "tratáis", "tratan"] }, { spanish: "lograr", english: "to achieve", conjugations: ["logro", "logras", "logra", "logramos", "lográis", "logran"] }, { spanish: "realizar", english: "to carry out", conjugations: ["realizo", "realizas", "realiza", "realizamos", "realizáis", "realizan"] }, { spanish: "cumplir", english: "to fulfill", conjugations: ["cumplo", "cumples", "cumple", "cumplimos", "cumplís", "cumplen"] }, { spanish: "completar", english: "to complete", conjugations: ["completo", "completas", "completa", "completamos", "completáis", "completan"] } ],
            "Business & Professional": [ { spanish: "dirigir", english: "to direct/manage", conjugations: ["dirijo", "diriges", "dirige", "dirigimos", "dirigís", "dirigen"] }, { spanish: "organizar", english: "to organize", conjugations: ["organizo", "organizas", "organiza", "organizamos", "organizáis", "organizan"] }, { spanish: "planear", english: "to plan", conjugations: ["planeo", "planeas", "planea", "planeamos", "planeáis", "planean"] }, { spanish: "presentar", english: "to present", conjugations: ["presento", "presentas", "presenta", "presentamos", "presentáis", "presentan"] }, { spanish: "ofrecer", english: "to offer", conjugations: ["ofrezco", "ofreces", "ofrece", "ofrecemos", "ofrecéis", "ofrecen"] }, { spanish: "firmar", english: "to sign", conjugations: ["firmo", "firmas", "firma", "firmamos", "firmáis", "firman"] }, { spanish: "contratar", english: "to hire", conjugations: ["contrato", "contratas", "contrata", "contratamos", "contratáis", "contratan"] }, { spanish: "despedir", english: "to fire/say farewell", conjugations: ["despido", "despides", "despide", "despedimos", "despedís", "despiden"] }, { spanish: "promocionar", english: "to promote", conjugations: ["promociono", "promocionas", "promociona", "promocionamos", "promocionáis", "promocionan"] }, { spanish: "negociar", english: "to negotiate", conjugations: ["negocio", "negocias", "negocia", "negociamos", "negociáis", "negocian"] }, { spanish: "invertir", english: "to invest", conjugations: ["invierto", "inviertes", "invierte", "invertimos", "invertís", "invierten"] }, { spanish: "administrar", english: "to administer", conjugations: ["administro", "administras", "administra", "administramos", "administráis", "administran"] }, { spanish: "supervisar", english: "to supervise", conjugations: ["superviso", "supervisas", "supervisa", "supervisamos", "supervisáis", "supervisan"] }, { spanish: "entrenar", english: "to train", conjugations: ["entreno", "entrenas", "entrena", "entrenamos", "entrenáis", "entrenan"] }, { spanish: "colaborar", english: "to collaborate", conjugations: ["colaboro", "colaboras", "colabora", "colaboramos", "colaboráis", "colaboran"] } ]
        };
        const baseNounSets = {
            "People & Family": [ { spanish: "la familia", english: "family" }, { spanish: "la madre", english: "mother" }, { spanish: "el padre", english: "father" }, { spanish: "el hijo", english: "son" }, { spanish: "la hija", english: "daughter" }, { spanish: "el hermano", english: "brother" }, { spanish: "la hermana", english: "sister" }, { spanish: "el abuelo", english: "grandfather" }, { spanish: "la abuela", english: "grandmother" }, { spanish: "el tío", english: "uncle" }, { spanish: "la tía", english: "aunt" }, { spanish: "el primo", english: "cousin (male)" }, { spanish: "la prima", english: "cousin (female)" }, { spanish: "el esposo", english: "husband" }, { spanish: "la esposa", english: "wife" } ],
            "Home & Furniture": [ { spanish: "la casa", english: "house" }, { spanish: "el apartamento", english: "apartment" }, { spanish: "la habitación", english: "room" }, { spanish: "la cocina", english: "kitchen" }, { spanish: "el baño", english: "bathroom" }, { spanish: "la sala", english: "living room" }, { spanish: "el dormitorio", english: "bedroom" }, { spanish: "la cama", english: "bed" }, { spanish: "la mesa", english: "table" }, { spanish: "la silla", english: "chair" }, { spanish: "el sofá", english: "sofa" }, { spanish: "el armario", english: "closet" }, { spanish: "la ventana", english: "window" }, { spanish: "la puerta", english: "door" }, { spanish: "la escalera", english: "stairs" } ],
            "Food & Drinks": [ { spanish: "la comida", english: "food" }, { spanish: "el agua", english: "water" }, { spanish: "la leche", english: "milk" }, { spanish: "el pan", english: "bread" }, { spanish: "la carne", english: "meat" }, { spanish: "el pollo", english: "chicken" }, { spanish: "el pescado", english: "fish" }, { spanish: "la fruta", english: "fruit" }, { spanish: "la verdura", english: "vegetable" }, { spanish: "el arroz", english: "rice" }, { spanish: "la pasta", english: "pasta" }, { spanish: "el queso", english: "cheese" }, { spanish: "el huevo", english: "egg" }, { spanish: "el café", english: "coffee" }, { spanish: "el té", english: "tea" } ],
            "Clothing & Accessories": [ { spanish: "la ropa", english: "clothing" }, { spanish: "la camisa", english: "shirt" }, { spanish: "el pantalón", english: "pants" }, { spanish: "el vestido", english: "dress" }, { spanish: "los zapatos", english: "shoes" }, { spanish: "los calcetines", english: "socks" }, { spanish: "la chaqueta", english: "jacket" }, { spanish: "el abrigo", english: "coat" }, { spanish: "el sombrero", english: "hat" }, { spanish: "el cinturón", english: "belt" }, { spanish: "la corbata", english: "tie" }, { spanish: "la falda", english: "skirt" }, { spanish: "la blusa", english: "blouse" }, { spanish: "el suéter", english: "sweater" }, { spanish: "las botas", english: "boots" } ],
            "Body & Health": [ { spanish: "el cuerpo", english: "body" }, { spanish: "la cabeza", english: "head" }, { spanish: "la cara", english: "face" }, { spanish: "el ojo", english: "eye" }, { spanish: "la nariz", english: "nose" }, { spanish: "la boca", english: "mouth" }, { spanish: "la oreja", english: "ear" }, { spanish: "la mano", english: "hand" }, { spanish: "el brazo", english: "arm" }, { spanish: "la pierna", english: "leg" }, { spanish: "el pie", english: "foot" }, { spanish: "el corazón", english: "heart" }, { spanish: "el estómago", english: "stomach" }, { spanish: "la espalda", english: "back" }, { spanish: "el cuello", english: "neck" } ],
            "Transportation & Travel": [ { spanish: "el coche", english: "car" }, { spanish: "el autobús", english: "bus" }, { spanish: "el tren", english: "train" }, { spanish: "el avión", english: "airplane" }, { spanish: "el barco", english: "boat" }, { spanish: "la bicicleta", english: "bicycle" }, { spanish: "la motocicleta", english: "motorcycle" }, { spanish: "el taxi", english: "taxi" }, { spanish: "el metro", english: "subway" }, { spanish: "el aeropuerto", english: "airport" }, { spanish: "la estación", english: "station" }, { spanish: "el puerto", english: "port" }, { spanish: "la gasolinera", english: "gas station" }, { spanish: "el semáforo", english: "traffic light" }, { spanish: "la carretera", english: "highway" } ],
            "Work & Education": [ { spanish: "el trabajo", english: "job/work" }, { spanish: "la oficina", english: "office" }, { spanish: "la escuela", english: "school" }, { spanish: "la universidad", english: "university" }, { spanish: "la clase", english: "class" }, { spanish: "el profesor / la profesora", english: "teacher" }, { spanish: "el/la estudiante", english: "student" }, { spanish: "el libro", english: "book" }, { spanish: "el cuaderno", english: "notebook" }, { spanish: "el lápiz", english: "pencil" }, { spanish: "la pluma", english: "pen" }, { spanish: "el examen", english: "exam" }, { spanish: "la tarea", english: "homework" }, { spanish: "la biblioteca", english: "library" }, { spanish: "el laboratorio", english: "laboratory" } ],
            "Time & Weather": [ { spanish: "el tiempo", english: "time/weather" }, { spanish: "la hora", english: "hour" }, { spanish: "el minuto", english: "minute" }, { spanish: "el día", english: "day" }, { spanish: "la semana", english: "week" }, { spanish: "el mes", english: "month" }, { spanish: "el año", english: "year" }, { spanish: "la mañana", english: "morning" }, { spanish: "la tarde", english: "afternoon" }, { spanish: "la noche", english: "night" }, { spanish: "el sol", english: "sun" }, { spanish: "la lluvia", english: "rain" }, { spanish: "el viento", english: "wind" }, { spanish: "la nieve", english: "snow" }, { spanish: "la temperatura", english: "temperature" } ],
            "Places & Locations": [ { spanish: "la ciudad", english: "city" }, { spanish: "el pueblo", english: "town" }, { spanish: "el país", english: "country" }, { spanish: "la calle", english: "street" }, { spanish: "la avenida", english: "avenue" }, { spanish: "la plaza", english: "square" }, { spanish: "el parque", english: "park" }, { spanish: "la tienda", english: "store" }, { spanish: "el supermercado", english: "supermarket" }, { spanish: "el restaurante", english: "restaurant" }, { spanish: "el hospital", english: "hospital" }, { spanish: "el banco", english: "bank" }, { spanish: "la oficina de correos", english: "post office" }, { spanish: "la iglesia", english: "church" }, { spanish: "el museo", english: "museum" } ],
            "Objects & Technology": [ { spanish: "el teléfono", english: "telephone" }, { spanish: "el ordenador", english: "computer" }, { spanish: "la televisión", english: "television" }, { spanish: "la radio", english: "radio" }, { spanish: "la cámara", english: "camera" }, { spanish: "el reloj", english: "watch/clock" }, { spanish: "las llaves", english: "keys" }, { spanish: "el dinero", english: "money" }, { spanish: "la tarjeta", english: "card" }, { spanish: "el bolso", english: "bag/purse" }, { spanish: "la maleta", english: "suitcase" }, { spanish: "el paraguas", english: "umbrella" }, { spanish: "las gafas", english: "glasses" }, { spanish: "el periódico", english: "newspaper" }, { spanish: "la revista", english: "magazine" } ]
        };
        const basePhraseSets = {
            "Greetings & Introductions": [ { spanish: "Hola, ¿cómo estás?", english: "Hello, how are you?" }, { spanish: "Me llamo...", english: "My name is..." }, { spanish: "¿Cómo te llamas?", english: "What's your name?" }, { spanish: "Mucho gusto", english: "Nice to meet you" }, { spanish: "¿De dónde eres?", english: "Where are you from?" }, { spanish: "Soy de...", english: "I'm from..." }, { spanish: "Buenos días", english: "Good morning" }, { spanish: "Buenas tardes", english: "Good afternoon" }, { spanish: "Buenas noches", english: "Good evening/night" }, { spanish: "Hasta luego", english: "See you later" }, { spanish: "Hasta mañana", english: "See you tomorrow" }, { spanish: "¿Qué tal?", english: "How's it going?" }, { spanish: "Encantado/a", english: "Pleased to meet you" }, { spanish: "Adiós", english: "Goodbye" }, { spanish: "Nos vemos", english: "See you" } ],
            "Basic Courtesy & Politeness": [ { spanish: "Por favor", english: "Please" }, { spanish: "Gracias", english: "Thank you" }, { spanish: "De nada", english: "You're welcome" }, { spanish: "Lo siento", english: "I'm sorry" }, { spanish: "Perdón", english: "Excuse me/Sorry" }, { spanish: "Disculpe", english: "Excuse me (formal)" }, { spanish: "Con permiso", english: "Excuse me (to pass)" }, { spanish: "¿Puedo ayudarle?", english: "Can I help you?" }, { spanish: "No hay problema", english: "No problem" }, { spanish: "Está bien", english: "It's okay" }, { spanish: "Muchas gracias", english: "Thank you very much" }, { spanish: "No se preocupe", english: "Don't worry" }, { spanish: "Perdone la molestia", english: "Sorry to bother you" }, { spanish: "¿Me permite?", english: "May I?" }, { spanish: "Es muy amable", english: "That's very kind" } ],
            "Asking Questions": [ { spanish: "¿Qué es esto?", english: "What is this?" }, { spanish: "¿Dónde está...?", english: "Where is...?" }, { spanish: "¿Cuánto cuesta?", english: "How much does it cost?" }, { spanish: "¿Habla inglés?", english: "Do you speak English?" }, { spanish: "¿Puede repetir?", english: "Can you repeat?" }, { spanish: "¿Cómo se dice...?", english: "How do you say...?" }, { spanish: "¿Qué significa?", english: "What does it mean?" }, { spanish: "¿A qué hora...?", english: "At what time...?" }, { spanish: "¿Por qué?", english: "Why?" }, { spanish: "¿Cuándo?", english: "When?" }, { spanish: "¿Quién es?", english: "Who is it?" }, { spanish: "¿Puedo...?", english: "Can I...?" }, { spanish: "¿Está libre?", english: "Is it free/available?" }, { spanish: "¿Hay...?", english: "Is there.../Are there...?" }, { spanish: "¿Entiende?", english: "Do you understand?" } ],
            "Time & Scheduling": [ { spanish: "¿Qué hora es?", english: "What time is it?" }, { spanish: "Son las dos", english: "It's two o'clock" }, { spanish: "Es la una", english: "It's one o'clock" }, { spanish: "A las tres", english: "At three o'clock" }, { spanish: "Por la mañana", english: "In the morning" }, { spanish: "Por la tarde", english: "In the afternoon" }, { spanish: "Por la noche", english: "At night" }, { spanish: "Hoy", english: "Today" }, { spanish: "Mañana", english: "Tomorrow" }, { spanish: "Ayer", english: "Yesterday" }, { spanish: "Esta semana", english: "This week" }, { spanish: "El fin de semana", english: "The weekend" }, { spanish: "¿Cuándo nos vemos?", english: "When shall we meet?" }, { spanish: "Tengo una cita", english: "I have an appointment" }, { spanish: "Llego tarde", english: "I'm running late" } ],
            "Food & Dining": [ { spanish: "Tengo hambre", english: "I'm hungry" }, { spanish: "Tengo sed", english: "I'm thirsty" }, { spanish: "¿Qué desea?", english: "What would you like?" }, { spanish: "Quisiera...", english: "I would like..." }, { spanish: "La cuenta, por favor", english: "The check, please" }, { spanish: "Está delicioso", english: "It's delicious" }, { spanish: "No me gusta", english: "I don't like it" }, { spanish: "¿Qué recomienda?", english: "What do you recommend?" }, { spanish: "Soy vegetariano/a", english: "I'm vegetarian" }, { spanish: "¿Hay menú en inglés?", english: "Is there an English menu?" }, { spanish: "Un café, por favor", english: "A coffee, please" }, { spanish: "¿Puedo ver la carta?", english: "Can I see the menu?" }, { spanish: "¿Está incluida la propina?", english: "Is the tip included?" }, { spanish: "Me trae..., por favor", english: "Bring me..., please" }, { spanish: "Buen provecho", english: "Enjoy your meal" } ],
            "Shopping & Money": [ { spanish: "¿Cuánto vale?", english: "How much is it worth?" }, { spanish: "Es muy caro", english: "It's very expensive" }, { spanish: "Es barato", english: "It's cheap" }, { spanish: "¿Hay descuento?", english: "Is there a discount?" }, { spanish: "¿Acepta tarjetas?", english: "Do you accept cards?" }, { spanish: "Solo tengo efectivo", english: "I only have cash" }, { spanish: "¿Dónde pago?", english: "Where do I pay?" }, { spanish: "Me queda bien", english: "It fits me well" }, { spanish: "Es demasiado grande", english: "It's too big" }, { spanish: "Es demasiado pequeño", english: "It's too small" }, { spanish: "¿Tienen mi talla?", english: "Do you have my size?" }, { spanish: "¿Puedo probármelo?", english: "Can I try it on?" }, { spanish: "Me lo llevo", english: "I'll take it" }, { spanish: "¿Está en oferta?", english: "Is it on sale?" }, { spanish: "¿Tiene cambio?", english: "Do you have change?" } ],
            "Directions & Transportation": [ { spanish: "¿Dónde está el baño?", english: "Where is the bathroom?" }, { spanish: "¿Cómo llego a...?", english: "How do I get to...?" }, { spanish: "Está cerca", english: "It's nearby" }, { spanish: "Está lejos", english: "It's far" }, { spanish: "A la derecha", english: "To the right" }, { spanish: "A la izquierda", english: "To the left" }, { spanish: "Todo recto", english: "Straight ahead" }, { spanish: "¿Cuánto tiempo tarda?", english: "How long does it take?" }, { spanish: "Perdí el autobús", english: "I missed the bus" }, { spanish: "¿Dónde para el metro?", english: "Where does the subway stop?" }, { spanish: "¿Este tren va a...?", english: "Does this train go to...?" }, { spanish: "Una ida", english: "One way (ticket)" }, { spanish: "Ida y vuelta", english: "Round trip" }, { spanish: "¿En qué parada bajo?", english: "Which stop do I get off at?" }, { spanish: "¿Puede llamar un taxi?", english: "Can you call a taxi?" } ],
            "Feelings & Opinions": [ { spanish: "Me gusta mucho", english: "I like it a lot" }, { spanish: "No me gusta nada", english: "I don't like it at all" }, { spanish: "Estoy cansado/a", english: "I'm tired" }, { spanish: "Estoy feliz", english: "I'm happy" }, { spanish: "Estoy triste", english: "I'm sad" }, { spanish: "Tengo miedo", english: "I'm scared" }, { spanish: "Estoy preocupado/a", english: "I'm worried" }, { spanish: "Me siento bien", english: "I feel good" }, { spanish: "No me siento bien", english: "I don't feel well" }, { spanish: "Creo que sí", english: "I think so" }, { spanish: "Creo que no", english: "I don't think so" }, { spanish: "No estoy seguro/a", english: "I'm not sure" }, { spanish: "Tienes razón", english: "You're right" }, { spanish: "No estoy de acuerdo", english: "I don't agree" }, { spanish: "¡Qué bonito!", english: "How beautiful!" } ],
            "Emergency & Health": [ { spanish: "¡Ayuda!", english: "Help!" }, { spanish: "Llame a la policía", english: "Call the police" }, { spanish: "Necesito un médico", english: "I need a doctor" }, { spanish: "Me duele...", english: "...hurts" }, { spanish: "Me duele la cabeza", english: "I have a headache" }, { spanish: "Estoy enfermo/a", english: "I'm sick" }, { spanish: "Tengo fiebre", english: "I have a fever" }, { spanish: "¿Dónde está el hospital?", english: "Where is the hospital?" }, { spanish: "Es una emergencia", english: "It's an emergency" }, { spanish: "Perdí mi pasaporte", english: "I lost my passport" }, { spanish: "Me robaron", english: "I was robbed" }, { spanish: "¿Habla español?", english: "Do you speak Spanish?" }, { spanish: "No hablo español", english: "I don't speak Spanish" }, { spanish: "Necesito ayuda", english: "I need help" }, { spanish: "¿Puede llamar...?", english: "Can you call...?" } ],
            "Daily Conversations": [ { spanish: "¿Qué tiempo hace?", english: "What's the weather like?" }, { spanish: "Hace calor", english: "It's hot" }, { spanish: "Hace frío", english: "It's cold" }, { spanish: "Llueve", english: "It's raining" }, { spanish: "¿Qué planes tienes?", english: "What are your plans?" }, { spanish: "Nada especial", english: "Nothing special" }, { spanish: "¿Te gusta...?", english: "Do you like...?" }, { spanish: "Por supuesto", english: "Of course" }, { spanish: "Claro que sí", english: "Of course/Sure" }, { spanish: "No importa", english: "It doesn't matter" }, { spanish: "Depende", english: "It depends" }, { spanish: "¡Qué interesante!", english: "How interesting!" }, { spanish: "No lo sé", english: "I don't know" }, { spanish: "Quizás", english: "Maybe/Perhaps" }, { spanish: "¿Cuánto tiempo...?", english: "How long...?" } ]
        };
        const allDataSets = { ...baseVerbSets, ...baseNounSets, ...basePhraseSets };

        // --- Refactored Component: Flashcard ---
        const Flashcard = ({ card, isFlipped, mode }) => {
            const getDynamicFontSize = (text) => {
                if (!text) return 'sm:text-5xl text-4xl';
                if (text.length > 30) return 'sm:text-3xl text-2xl';
                if (text.length > 20) return 'sm:text-4xl text-3xl';
                return 'sm:text-5xl text-4xl';
            };
            
            if (!card) {
                return (
                    <div className="absolute inset-0 w-full h-full bg-white rounded-xl shadow-lg border-2 border-gray-200 flex flex-col items-center justify-center p-4 text-center">
                        <div className="text-lg text-gray-600 font-medium">You've mastered all cards in this set!</div>
                        <div className="text-sm text-gray-500 mt-2">Deselect a category or press Reset to study again.</div>
                    </div>
                );
            }

            const frontText = mode === 'spanish-to-english' ? card.spanish : card.english;
            const backText = mode === 'spanish-to-english' ? card.english : card.spanish;

            return (
                <div className={`absolute inset-0 w-full h-full transition-transform duration-500 transform-style-preserve-3d ${isFlipped ? 'rotate-y-180' : ''}`}>
                    <div className="absolute inset-0 w-full h-full bg-white rounded-xl shadow-lg border-2 border-indigo-100 backface-hidden flex flex-col items-center justify-center p-6">
                        <div className="text-xs uppercase tracking-wide text-gray-500 mb-2">{mode === 'spanish-to-english' ? 'Español' : 'English'}</div>
                        <div className={`font-bold text-gray-800 text-center ${getDynamicFontSize(frontText)}`}>{frontText}</div>
                        <div className="absolute bottom-4 text-xs text-gray-400 mt-4">Tap or swipe</div>
                    </div>
                    <div className="absolute inset-0 w-full h-full bg-indigo-50 rounded-xl shadow-lg border-2 border-indigo-200 backface-hidden rotate-y-180 flex flex-col items-center justify-center p-6">
                        <div className="text-xs uppercase tracking-wide text-indigo-600 mb-2">{mode === 'spanish-to-english' ? 'English' : 'Español'}</div>
                        <div className={`font-bold text-indigo-800 text-center mb-4 ${getDynamicFontSize(backText)}`}>{backText}</div>
                        {card.type === 'verb' && (
                            <div className="w-full max-w-xs">
                                <div className="text-xs text-indigo-600 text-center mb-2">Present Tense Conjugations</div>
                                <div className="grid grid-cols-2 gap-x-4 gap-y-1 text-xs">
                                    {["yo", "tú", "él/ella", "nosotros", "vosotros", "ellos/ellas"].map((p, i) => <React.Fragment key={p}><div className="text-right text-indigo-700">{p}</div><div className="font-medium text-indigo-900">{card.conjugations[i]}</div></React.Fragment>)}
                                </div>
                            </div>
                        )}
                        <div className="absolute bottom-4 text-xs text-indigo-400">Tap or swipe</div>
                    </div>
                </div>
            );
        };

        // --- Refactored Component: DeckControls ---
        const DeckControls = ({ handlers, state }) => (
            <div className="flex justify-between items-center mb-6 mt-4">
                <button onClick={handlers.handlePrevious} disabled={state.deckSize < 2 || state.isAnimating} className="flex items-center gap-2 px-4 py-2 bg-white rounded-lg shadow-sm border disabled:opacity-50 disabled:cursor-not-allowed hover:bg-gray-50 transition-colors text-sm"><ChevronLeftIcon />Previous</button>
                <div className="flex items-center gap-2">
                    <button onClick={handlers.resetDeckProgress} disabled={state.totalPotentialCards === 0} className="p-2 bg-white rounded-lg shadow-sm border hover:bg-gray-50 transition-colors disabled:opacity-50 disabled:cursor-not-allowed" title="Reset Progress for Selected Sets" aria-label="Reset deck progress"><RefreshIcon /></button>
                    <button onClick={handlers.handleSpeakerClick} disabled={!state.isCardPresent} className="p-2 bg-white rounded-lg shadow-sm border hover:bg-gray-50 transition-colors disabled:opacity-50 disabled:cursor-not-allowed" title="Play audio" aria-label="Play audio"><SpeakerIcon /></button>
                    <button onClick={handlers.handleToggleRemembered} disabled={!state.isCardPresent || state.isAnimating} className={`p-2 rounded-lg shadow-sm border transition-colors disabled:opacity-50 disabled:cursor-not-allowed ${state.isRemembered ? 'bg-green-500 text-white border-green-600 hover:bg-green-600' : 'bg-white text-gray-600 hover:bg-gray-50'}`} title={state.isRemembered ? "Mark as not known" : "Mark as known"}><CheckIcon /></button>
                </div>
                <button onClick={handlers.handleNext} disabled={state.deckSize < 2 || state.isAnimating} className="flex items-center gap-2 px-4 py-2 bg-indigo-600 text-white rounded-lg shadow-sm disabled:opacity-50 disabled:cursor-not-allowed hover:bg-indigo-700 transition-colors text-sm">Next<ChevronRightIcon /></button>
            </div>
        );

        // --- Refactored Component: CategoryTabs ---
        const CategoryTabs = ({ activeTab, setActiveTab, activeSets, handleSetToggle }) => {
             const CheckboxGrid = ({ sets, type, onToggleAll }) => (
                <div className="mb-6 bg-white/50 p-4 rounded-lg border border-gray-200 shadow-sm">
                    <div className="flex justify-between items-center mb-3">
                        <label className="text-sm font-medium text-gray-800">Choose {type} Sets:</label>
                        <div className="flex gap-2">
                            <button onClick={() => onToggleAll(sets, true)} className="text-xs font-medium text-indigo-600 hover:text-indigo-800">Select All</button>
                            <button onClick={() => onToggleAll(sets, false)} className="text-xs font-medium text-indigo-600 hover:text-indigo-800">Deselect All</button>
                        </div>
                    </div>
                    <div className="grid grid-cols-1 sm:grid-cols-2 gap-x-4 gap-y-2">
                        {Object.keys(sets).map((setName) => (
                            <label key={setName} className="flex items-center space-x-2 cursor-pointer p-2 rounded-md hover:bg-indigo-100/50">
                                <input type="checkbox" checked={!!activeSets[setName]} onChange={() => handleSetToggle(setName)} className="h-4 w-4 rounded border-gray-300 text-indigo-600 focus:ring-indigo-500"/>
                                <span className="text-sm text-gray-700 select-none">{setName}</span>
                            </label>
                        ))}
                    </div>
                </div>
            );
            return (
                <div>
                    <div className="border-b border-gray-200"><nav className="-mb-px flex justify-center gap-6" aria-label="Tabs">
                        <button onClick={() => setActiveTab('verbs')} className={`${activeTab === 'verbs' ? 'border-indigo-500 text-indigo-600' : 'border-transparent text-gray-500 hover:text-gray-700'} py-4 px-1 border-b-2 font-medium text-sm`}>Verbs</button>
                        <button onClick={() => setActiveTab('nouns')} className={`${activeTab === 'nouns' ? 'border-indigo-500 text-indigo-600' : 'border-transparent text-gray-500 hover:text-gray-700'} py-4 px-1 border-b-2 font-medium text-sm`}>Nouns</button>
                        <button onClick={() => setActiveTab('phrases')} className={`${activeTab === 'phrases' ? 'border-indigo-500 text-indigo-600' : 'border-transparent text-gray-500 hover:text-gray-700'} py-4 px-1 border-b-2 font-medium text-sm`}>Phrases</button>
                    </nav></div>
                    <div className="pt-5">
                        {activeTab === 'verbs' && <CheckboxGrid sets={baseVerbSets} type="Verb" onToggleAll={(sets, shouldSelect) => Object.keys(sets).forEach(name => handleSetToggle(name, shouldSelect))} />}
                        {activeTab === 'nouns' && <CheckboxGrid sets={baseNounSets} type="Noun" onToggleAll={(sets, shouldSelect) => Object.keys(sets).forEach(name => handleSetToggle(name, shouldSelect))} />}
                        {activeTab === 'phrases' && <CheckboxGrid sets={basePhraseSets} type="Phrase" onToggleAll={(sets, shouldSelect) => Object.keys(sets).forEach(name => handleSetToggle(name, shouldSelect))} />}
                    </div>
                </div>
            );
        };

        // --- Main App Component ---
        const SpanishFlashcards = () => {
            const [currentIndex, setCurrentIndex] = useState(0);
            const [isFlipped, setIsFlipped] = useState(false);
            const [mode, setMode] = useState('spanish-to-english');
            const [activeTab, setActiveTab] = useState('verbs');
            const [activeSets, setActiveSets] = useState({ "Essential Being & Having": true });
            const [shuffledCards, setShuffledCards] = useState([]);
            const [voices, setVoices] = useState([]);
            const interactionRef = useRef({});
            const [isAnimating, setIsAnimating] = useState(false);
            const FLIP_ANIMATION_DURATION = 500; 

            const [rememberedCards, setRememberedCards] = useState(() => {
                try {
                    const saved = localStorage.getItem('rememberedSpanishCards');
                    return saved ? new Set(JSON.parse(saved)) : new Set();
                } catch { return new Set(); }
            });

            useEffect(() => {
                const handler = setTimeout(() => {
                    try {
                        localStorage.setItem('rememberedSpanishCards', JSON.stringify(Array.from(rememberedCards)));
                    } catch (error) {
                        console.error("Failed to save progress to localStorage:", error);
                    }
                }, 500);
                return () => clearTimeout(handler);
            }, [rememberedCards]);
            
            useEffect(() => {
                const loadVoices = () => setVoices(window.speechSynthesis.getVoices());
                window.speechSynthesis.onvoiceschanged = loadVoices;
                loadVoices();
                return () => {
                    window.speechSynthesis.onvoiceschanged = null;
                };
            }, []);

            const totalPotentialCards = useMemo(() => {
                const getSetType = (setName) => {
                    if (baseVerbSets[setName]) return 'verb';
                    if (baseNounSets[setName]) return 'noun';
                    if (basePhraseSets[setName]) return 'phrase';
                };
                return Object.keys(activeSets).flatMap(setName => 
                    (activeSets[setName] && allDataSets[setName]) 
                        ? allDataSets[setName].map(card => ({ ...card, type: getSetType(setName) })) 
                        : []
                ).filter((card, index, self) => index === self.findIndex(c => c.spanish === card.spanish));
            }, [activeSets]);

            const shuffle = (array) => {
                const newArray = [...array];
                for (let i = newArray.length - 1; i > 0; i--) {
                    const j = Math.floor(Math.random() * (i + 1));
                    [newArray[i], newArray[j]] = [newArray[j], newArray[i]];
                }
                return newArray;
            };

            useEffect(() => {
                const cardsToStudy = totalPotentialCards.filter(card => !rememberedCards.has(card.spanish));
                setShuffledCards(shuffle(cardsToStudy));
                setCurrentIndex(0);
                setIsFlipped(false);
            }, [totalPotentialCards]);

            const handleShuffle = () => {
                const cardsToStudy = shuffledCards;
                setShuffledCards(shuffle(cardsToStudy));
                setCurrentIndex(0);
                setIsFlipped(false);
            };

            const speakText = useCallback((text) => {
                if (!('speechSynthesis' in window)) {
                    console.warn("Speech synthesis not supported in this browser.");
                    return;
                }
                window.speechSynthesis.cancel();
                const utterance = new SpeechSynthesisUtterance(text);
                utterance.lang = 'es-ES';
                utterance.rate = 0.8;
                const spanishVoice = voices.find(v => v.lang === 'es-ES') || voices.find(v => v.lang.startsWith('es-'));
                if (spanishVoice) utterance.voice = spanishVoice;
                
                utterance.onerror = (event) => {
                    console.error('An error occurred during speech synthesis:', event);
                };
                
                window.speechSynthesis.speak(utterance);
            }, [voices]);

            const navigate = useCallback((direction) => {
                if (isAnimating || shuffledCards.length === 0) return;

                const changeCard = () => {
                    setCurrentIndex(i => {
                        if (direction === 'next') return (i + 1) % shuffledCards.length;
                        return (i - 1 + shuffledCards.length) % shuffledCards.length;
                    });
                };
                
                if (isFlipped) {
                    setIsAnimating(true);
                    setIsFlipped(false);
                    
                    setTimeout(() => {
                        changeCard();
                        setIsAnimating(false);
                    }, FLIP_ANIMATION_DURATION);
                } else {
                    changeCard();
                }
            }, [isFlipped, isAnimating, shuffledCards.length]);

            const handleNext = () => navigate('next');
            const handlePrevious = () => navigate('previous');

            const handleFlip = () => { if (shuffledCards.length > 0) setIsFlipped(f => !f); };
            const handleSpeakerClick = () => { if (shuffledCards[currentIndex]) speakText(shuffledCards[currentIndex].spanish); };
            
            const handleToggleRemembered = () => {
                const currentCard = shuffledCards[currentIndex];
                // Guard against clicks when there's no card or an animation is in progress
                if (!currentCard || isAnimating) return;

                const isAlreadyRemembered = rememberedCards.has(currentCard.spanish);

                // This function contains the logic to update the deck
                const performUpdate = () => {
                    setRememberedCards(prev => {
                        const newSet = new Set(prev);
                        if (isAlreadyRemembered) {
                            newSet.delete(currentCard.spanish);
                        } else {
                            newSet.add(currentCard.spanish);
                        }
                        return newSet;
                    });
            
                    // Only remove the card from the visible deck if it's being newly remembered
                    if (!isAlreadyRemembered) {
                        setShuffledCards(prevCards => {
                            const newCards = prevCards.filter(card => card.spanish !== currentCard.spanish);
                            setCurrentIndex(prevIndex => Math.min(prevIndex, newCards.length > 0 ? newCards.length - 1 : 0));
                            return newCards;
                        });
                    }
                };
                
                // Check if we are remembering a card (not un-remembering) and if it's currently flipped
                if (isFlipped && !isAlreadyRemembered) {
                    // If so, start the flip-back animation first
                    setIsAnimating(true);
                    setIsFlipped(false);
                    
                    // After the animation duration, perform the deck update
                    setTimeout(() => {
                        performUpdate();
                        setIsAnimating(false);
                    }, FLIP_ANIMATION_DURATION);
                } else {
                    // Otherwise (if card is not flipped or is being un-remembered), update immediately
                    // and ensure the next card starts on the front.
                    setIsFlipped(false);
                    performUpdate();
                }
            };

            const resetDeckProgress = () => {
                const cardsInCurrentCategories = totalPotentialCards.map(card => card.spanish);
                setRememberedCards(prev => {
                    const newSet = new Set(prev);
                    cardsInCurrentCategories.forEach(id => newSet.delete(id));
                    return newSet;
                });
                setShuffledCards(shuffle(totalPotentialCards));
                setCurrentIndex(0);
                setIsFlipped(false);
            };

            const handleSetToggle = (setName, forceState) => {
                setActiveSets(prev => {
                    const newActiveSets = { ...prev };
                    const isCurrentlyActive = !!prev[setName];
                    const shouldBeActive = typeof forceState === 'boolean' ? forceState : !isCurrentlyActive;
            
                    if (shouldBeActive) {
                        newActiveSets[setName] = true;
                    } else {
                        delete newActiveSets[setName];
                    }
                    return newActiveSets;
                });
            };
            
            const handlePointerDown = (e) => {
                if (shuffledCards.length === 0 || isAnimating) return;
                e.preventDefault(); 
                interactionRef.current = {
                    startX: e.clientX,
                    isSwiping: false,
                };
                e.target.setPointerCapture(e.pointerId);
            };

            const handlePointerMove = (e) => {
                if (interactionRef.current.startX === undefined) return;
                const distance = Math.abs(e.clientX - interactionRef.current.startX);
                if (distance > 10) {
                    interactionRef.current.isSwiping = true;
                }
            };

            const handlePointerUp = (e) => {
                if (interactionRef.current.startX === undefined) return;
                
                const { startX, isSwiping } = interactionRef.current;
                const endX = e.clientX;
                const distance = endX - startX;
                const minSwipeDistance = 50;

                if (isSwiping && Math.abs(distance) > minSwipeDistance) {
                    if (distance < 0) handleNext();
                    else handlePrevious();
                } else {
                    handleFlip();
                }

                interactionRef.current = {};
                e.target.releasePointerCapture(e.pointerId);
            };

            const currentCard = shuffledCards[currentIndex];
            const rememberedCountInSet = useMemo(() => {
                const potentialIds = new Set(totalPotentialCards.map(c => c.spanish));
                let count = 0;
                for (const id of rememberedCards) {
                    if (potentialIds.has(id)) {
                        count++;
                    }
                }
                return count;
            }, [totalPotentialCards, rememberedCards]);
            
            const progress = totalPotentialCards.length > 0 ? (rememberedCountInSet / totalPotentialCards.length) * 100 : 0;
            const isRemembered = currentCard && rememberedCards.has(currentCard.spanish);

            return (
                <div className="min-h-screen bg-gradient-to-br from-blue-50 to-indigo-100 p-4 flex flex-col">
                    <div className="max-w-md mx-auto w-full flex flex-col flex-grow">
                        <header className="text-center mb-6">
                            <div className="flex items-center justify-center gap-2 mb-2"><BookIcon /><h1 className="text-2xl sm:text-3xl font-bold text-gray-800">Spanish Flashcards</h1></div>
                        </header>

                        <div className="mb-4">
                            <div className="flex justify-between text-sm text-gray-600 mb-1"><span>Mastery Progress</span><span>{rememberedCountInSet}/{totalPotentialCards.length} ({progress.toFixed(0)}%)</span></div>
                            <div className="w-full bg-gray-200 rounded-full h-2"><div className="bg-green-500 h-2 rounded-full" style={{ width: `${progress}%` }}></div></div>
                        </div>
                        <div className="flex justify-between items-center mb-6">
                            <button onClick={() => setMode(m => m === 'spanish-to-english' ? 'english-to-spanish' : 'english-to-english')} className="px-3 py-2 bg-white rounded-lg shadow-sm border text-sm font-medium text-gray-700 hover:bg-gray-50">{mode === 'spanish-to-english' ? 'ES → EN' : 'EN → ES'}</button>
                            <div className="text-sm font-medium text-gray-600">{shuffledCards.length > 0 ? `Card ${currentIndex + 1} / ${shuffledCards.length}` : 'Deck Empty'}</div>
                            <button onClick={handleShuffle} disabled={shuffledCards.length < 2} className="p-2 bg-white rounded-lg shadow-sm border hover:bg-gray-50 disabled:opacity-50"><ShuffleIcon /></button>
                        </div>

                        <div 
                            className="relative w-full h-80 cursor-pointer perspective-1000 touch-action-none"
                            onPointerDown={handlePointerDown}
                            onPointerMove={handlePointerMove}
                            onPointerUp={handlePointerUp}
                        >
                            <Flashcard card={currentCard} isFlipped={isFlipped} mode={mode} />
                        </div>
                        
                        <DeckControls 
                            handlers={{ handlePrevious, resetDeckProgress, handleSpeakerClick, handleToggleRemembered, handleNext }}
                            state={{ deckSize: shuffledCards.length, totalPotentialCards: totalPotentialCards.length, isCardPresent: !!currentCard, isRemembered, isAnimating }}
                        />

                        <div className="flex-grow"></div>

                        <CategoryTabs activeTab={activeTab} setActiveTab={setActiveTab} activeSets={activeSets} handleSetToggle={handleSetToggle} />
                    </div>
                </div>
            );
        };

        const root = ReactDOM.createRoot(document.getElementById('root'));
        root.render(<SpanishFlashcards />);
    </script>
</body>
</html>
